{
  "version": 3,
  "file": "Dist/deco.js",
  "sources": [
    "Source/deco/utils.js",
    "Source/deco/qvc/ExecutableResult.js",
    "Source/deco/qvc/Constraint.js",
    "Source/deco/qvc/Validator.js",
    "Source/deco/qvc/koExtensions.js",
    "Source/deco/qvc/Validatable.js",
    "Source/deco/qvc/Executable.js",
    "Source/deco/ajax.js",
    "Source/deco/qvc/ConstraintResolver.js",
    "Source/deco/errorHandler.js",
    "Source/deco/qvc.js",
    "Source/deco/spa/Outlet.js",
    "Source/deco/spa/whenContext.js",
    "Source/deco/spa/viewModelFactory.js",
    "Source/deco/spa/extendKnockout.js",
    "Source/deco/spa/applyViewModels.js",
    "Source/deco/spa/hashNavigation.js",
    "Source/deco/spa/PageLoader.js",
    "Source/deco/spa/Templates.js",
    "Source/deco/proclaimWhen.js",
    "Source/deco/events.js",
    "Source/deco/spa.js",
    "Source/deco/deco.js",
    "Source/deco/qvc/constraints/NotEmpty.js",
    "Source/deco/qvc/constraints/Pattern.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA,AD4EA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA,ADeA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA,ADyBA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvKA,ADwKA;ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA,ADsFA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnDA,ADoDA;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA,AD0EA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA,ADwDA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5GA,AD6GA;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtFA,ADuFA;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA,ADiEA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnFA,ADoFA;ACnFA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA,ADmEA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "sourcesContent": [
    "define('deco/utils',[], function(){\n  return {\n    \n    toArray: function(obj){\n      var array = [];\n      // iterate backwards ensuring that length is an UInt32\n      for (var i = obj.length >>> 0; i--;) { \n        array[i] = obj[i];\n      }\n      return array;\n    },\n    \n    extend: function(dst, src){\n      src = src || {};\n      dst = dst || {};\n      for(var i in src){\n        dst[i] = src[i];\n      }\n      return dst;\n    },\n    \n    inheritsFrom: function(o){\n      function F() {}\n      F.prototype = o.prototype;\n\n      return new F();\n    },\n    \n    arrayToObject: function(array, func){\n      return array.reduce(function(collection, item){\n        func(item, collection);\n        return collection;\n      }, {});\n    },\n    \n    trim: function(word, character){\n      for(var f=0; f<word.length; f++){\n        if(word.charAt(f) !== character) break;\n      }\n      for(var t=word.length; t>0; t--){\n        if(word.charAt(t-1) !== character) break;\n      }\n      return word.substring(f, t);\n    },\n    \n    after: function(word, character){\n      var index = word.indexOf(character);\n      if(index < 0){\n        return \"\";\n      }else{\n        return word.substr(index+1);\n      }\n    },\n    \n    popTail: function(array){\n      return array.slice(0, -1);\n    },\n    \n    startsWith: function(word, character){\n      return word.charAt(0) === character;\n    },\n    \n    endsWith: function(word, character){\n      return word.charAt(word.length - 1) === character;\n    },\n    \n    addEventListener: function(element, event, listener, bubble){\n      if('addEventListener' in element){\n        element.addEventListener(event, listener, bubble);\n      }else{\n        element.attachEvent(\"on\"+event, listener);    \n      }\n    }\n  };\n});\n\n",
    "define('deco/qvc/ExecutableResult',[\"deco/utils\"], function(utils){\r\n  function ExecutableResult(result){\r\n    \r\n    this.success = false;\r\n    this.valid = false;\r\n    this.result = null;\r\n    this.exception = null;\r\n    this.violations = [];\r\n  \r\n    utils.extend(this, result);\r\n  \r\n  };\r\n  \r\n  return ExecutableResult;\r\n});\n",
    "define('deco/qvc/Constraint',[], function(){\r\n  \r\n  function Constraint(type, attributes){    \r\n    this.type = type;\r\n    this.attributes = attributes;\r\n    this.message = attributes.message;\r\n    \r\n    \r\n    this.init(type);\r\n  }\r\n    \r\n  Constraint.prototype.init = function(type){\r\n    require([\"deco/qvc/constraints/\" + type], function(Tester){\r\n      var tester = new Tester(this.attributes);\r\n      this.validate = tester.isValid.bind(tester);\r\n    }.bind(this));\r\n  };\r\n  \r\n  Constraint.prototype.validate = function(value){\r\n    return true;//real test not loaded yet\r\n  };\r\n  \r\n  \r\n  return Constraint;\r\n});\n",
    "define('deco/qvc/Validator',[\n  \"deco/qvc/Constraint\", \n  \"knockout\"\n], function(\n  Constraint, \n  ko\n){\n\n  function interpolate(message, attributes, value, name, path){\n    return message.replace(/\\{([^}]+)\\}/g, function(match, key){\n      if(key == \"value\") return value;\n      if(key == \"this.name\") return name;\n      if(key == \"this.path\") return path;\n      if(key in attributes) return attributes[key];\n      return match;\n    });\n  }\n  \n\n  function Validator(target, options){\n    var self = this;\n    \n    this.constraints = [];\n    \n    this.isValid = ko.observable(true);\n    this.message = ko.observable(\"\");\n\n    this.name = options && options.name;\n    this.path = options && options.path;\n    this.executableName = options && options.executableName;\n    \n    if(target && ko.isObservable(target)){\n      target.isValid = function(){return self.isValid();};\n    }\n  }\n  \n  Validator.prototype.setConstraints = function(constraints){\n    this.constraints = constraints.map(function(constraint){\n      return new Constraint(constraint.name, constraint.attributes);\n    });\n  };\n  \n  Validator.prototype.reset = function(){\n    this.isValid(true);\n    this.message(\"\");\n  };\n  \n  Validator.prototype.validate = function(value){\n    if(this.constraints.length == 0){\n      this.reset();\n    }else if(this.constraints.every(function (constraint) {\n      if(constraint.validate(value)){\n        return true;\n      }else{\n        this.isValid(false);\n        this.message(interpolate(constraint.message, constraint.attributes, value, this.name, this.path));\n        return false;\n      }\n    }.bind(this))){\n      this.isValid(true);\n      this.message(\"\");\n    }\n  };\n  \n  return Validator;\n});\n",
    "define('deco/qvc/koExtensions',[\"deco/qvc/Validator\", \"knockout\"], function(Validator, ko){\n\n  if (ko != null) {\n    ko.bindingHandlers.validationMessageFor = {\n      init: function (element, valueAccessor, allBindingsAccessor, viewModel) {\n        var value = valueAccessor();\n        var validator = value.validator;\n        if (validator) {\n          ko.applyBindingsToNode(element, { hidden: validator.isValid, text: validator.message }, validator);\n        }else{\n          var attributes = Array.prototype.reduce.call(element.attributes, function(s,e){return s+\" \"+e.localName+\"=\\\"\"+e.value+\"\\\"\"}, \"\");\n          throw new Error(\"Could not bind `validationMessageFor` to value on element <\"+element.tagName.toLowerCase() + attributes +\">\");\n        }\n      }\n    };\n    \n    ko.bindingHandlers.command = ko.bindingHandlers.query = {\n      init: function (element, valueAccessor, allBindingAccessor, viewModel) {\n        ko.applyBindingsToNode(element, { click: valueAccessor() }, viewModel);\n      }\n    };\n  }\n  \n\n});\n",
    "define('deco/qvc/Validatable',[\n  \"deco/utils\", \n  \"deco/qvc/Validator\", \n  \"knockout\", \n  \"deco/qvc/koExtensions\"\n], function(\n  utils, \n  Validator, \n  ko\n){\n  \n  function Validatable(name, parameters, constraintResolver){\n    var self = this;\n    \n    this.validator = new Validator();\n    this.validatableFields = [];\n    this.validatableParameters = parameters;\n    \n    \n    init: {\n      recursivlyExtendParameters(self.validatableParameters, self.validatableFields, [], name);\n      if(constraintResolver)\n        constraintResolver.applyValidationConstraints(name, self);\n    }\n  }\n  \n  Validatable.prototype.isValid = function () {\n    return this.validatableFields.every(function(constraint){\n      return constraint.validator && constraint.validator.isValid();\n    }) && this.validator.isValid();\n  };\n    \n  Validatable.prototype.applyViolations = function(violations){\n    violations.forEach(function(violation){\n      var message = violation.message;\n      var fieldName = violation.fieldName;\n      if (fieldName && fieldName.length > 0) {\n        //one of the fields violates a constraint\n        applyViolationMessageToField(this.validatableParameters, fieldName, message);\n      } else {\n        //the validatable violates a constraint\n        applyViolationMessageToValidatable(this, message);\n      }\n    }.bind(this));\n  };\n  \n  Validatable.prototype.applyConstraints = function(fields){\n    var parameters = this.validatableParameters;\n    \n    fields.forEach(function(field){\n      var fieldName = field.name;\n      var constraints = field.constraints;\n\n      if(constraints == null || constraints.length == 0)\n        return;\n      \n      var object = findField(fieldName, parameters, \"Error applying constraints to field\");\n      \n      if (ko.isObservable(object) && \"validator\" in object) {\n        object.validator.setConstraints(constraints);\n      } else {\n        throw new Error(\"Error applying constraints to field: \" + fieldName + \"\\n\" +\n          \"It is not an observable or is not extended with a validator. \\n\" +\n          fieldName + \"=`\" + ko.toJSON(object) + \"`\");\n      }\n    });\n  };\n  \n  Validatable.prototype.validate = function(){\n    this.validator.validate(true);\n    if (this.validator.isValid()) {\n      this.validatableFields.forEach(function(constraint){\n        var validator = constraint.validator;\n        if (validator) {\n          validator.validate(constraint());\n        }\n      });\n    }\n  };\n  \n  Validatable.prototype.clearValidationMessages = function () {\n    this.validator.reset();\n    this.validatableFields.forEach(function(constraint){\n      var validator = constraint.validator;\n      if (validator) {\n        validator.reset();\n      }\n    });\n  };\n  \n  \n  \n  function recursivlyExtendParameters(parameters, validatableFields, parents, executableName) {\n    for (var key in parameters) {\n      var property = parameters[key];\n      var path = parents.concat([key]);\n      if (ko.isObservable(property)) {        \n        validatableFields.push(applyValidatorTo(property, key, path, executableName));\n      }\n      property = ko.utils.unwrapObservable(property);\n      if (typeof property === \"object\") {\n        recursivlyExtendParameters(property, validatableFields, path, executableName);\n      }\n    }\n  }\n\n\n  function findField(fieldPath, parameters, errorMessage){\n    return fieldPath.split(\".\").reduce(function(object, name){\n      var path = object.path;\n      var field = ko.utils.unwrapObservable(object.field);\n      if (name in field) {\n        return {\n          field: field[name],\n          path: path + \".\" + name\n        };\n      } else {\n        throw new Error(errorMessage + \": \" + fieldPath + \"\\n\" +\n          name + \" is not a member of \" + path + \"\\n\" +\n          path + \" = `\" + ko.toJSON(field) + \"`\");\n      }\n    }, {\n      field: parameters,\n      path: \"parameters\"\n    }).field;\n  }\n\n\n\n  \n  function applyViolationMessageToField(parameters, fieldPath, message) {\n    var object = findField(fieldPath, parameters, \"Error applying violation\");\n    \n    if (typeof message === \"string\" && \"validator\" in object) {\n      object.validator.isValid(false);\n      object.validator.message(message);\n    }else{\n      throw new Error(\"Error applying violation\\n\"+fieldPath+\" is not validatable\\nit should be an observable\");\n    }\n  };\n\n  function applyViolationMessageToValidatable(validatable, message) {\n    validatable.validator.isValid(false);\n    var oldMessage = validatable.validator.message();\n    var newMessage = oldMessage.length == 0 ? message : oldMessage + \", \" + message;\n    validatable.validator.message(newMessage);\n  };\n  \n  function applyValidatorTo(property, key, path, executableName){\n    if('validator' in property && property.validator instanceof Validator){\n      throw new Error(\"Observable `\"+path+\"` is parameter `\"+property.validator.path+\"` in \"+property.validator.executableName+\" and therefore cannot be a parameter in \"+executableName+\"!\");\n    }\n\n    property.validator = new Validator(property, {\n      name: key,\n      path: path.join(\".\"),\n      executableName: executableName\n    });\n\n    property.subscribe(function (newValue) {\n      property.validator.validate(newValue);\n    });\n    \n    return property;\n  }\n  \n  return Validatable;\n});\n",
    "define('deco/qvc/Executable',[\n  \"deco/qvc/ExecutableResult\", \n  \"deco/qvc/Validatable\", \n  \"deco/utils\", \n  \"knockout\"\n], function(\n  ExecutableResult, \n  Validatable, \n  utils, \n  ko){\n\n  function Executable(name, type, parameters, hooks, qvc){    \n    Validatable.call(this, name, parameters, qvc.constraintResolver)\n    \n    this.name = name;\n    this.type = type;\n    this.qvc = qvc;\n    this.isBusy = ko.observable(false);\n    this.hasError = ko.observable(false);\n    this.result = new ExecutableResult();\n    \n    this.parameters = Object.seal(parameters);\n    this.hooks = utils.extend({\n      beforeExecute: function () {},\n      canExecute: function(){return true;},\n      error: function () {},\n      success: function () {},\n      result: function(){},\n      complete: function () {},\n      invalid: function() {}\n    }, hooks);\n  }\n    \n  Executable.prototype = utils.inheritsFrom(Validatable);\n    \n  Executable.prototype.execute = function () {\n    if (this.isBusy()) {\n      return false;\n    }\n\n    this.hasError(false);\n\n    this.hooks.beforeExecute();\n\n    this.validate();\n    if (!this.isValid()) {\n      this.hooks.invalid();\n      return false;\n    }\n\n    if (this.hooks.canExecute() === false) {\n      return false;\n    }\n    this.isBusy(true);\n\n    this.qvc.execute(this);\n    return true;\n  };\n\n  Executable.prototype.onError = function () {\n    if(\"violations\" in this.result && this.result.violations != null && this.result.violations.length > 0){\n      this.applyViolations(this.result.violations);\n      this.hooks.invalid();\n    }else{\n      this.hasError(true);\n      this.hooks.error(this.result);\n    }\n  };\n\n  Executable.prototype.onSuccess = function () {\n    this.hasError(false);\n    this.clearValidationMessages();\n    this.hooks.success(this.result);\n    this.hooks.result(this.result.result);\n  };\n\n  Executable.prototype.onComplete = function () {\n    this.hooks.complete();\n    this.isBusy(false);\n  };\n  \n  Executable.Command = \"command\";\n  Executable.Query = \"query\";\n  \n  return Executable;\n});\n",
    "define('deco/ajax',[], function(){\n  function dataToParams(data){\n    var params = []\n    for(var key in data){\n      var value = data[key];\n      params.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(value));\n    }\n    return params.join(\"&\");\n  }\n\n  function addParamToUrl(url, name, value){\n    return url + (url.match(/\\?/) ? (url.match(/&$/) ? \"\" : \"&\") : \"?\") + encodeURIComponent(name) + \"=\" + encodeURIComponent(value);\n  }\n\n  function addParamsToUrl(url, data){\n    var params = dataToParams(data);\n    return url + (url.match(/\\?/) ? (url.match(/&$/) ? \"\" : (params.length > 0 ? \"&\" : \"\")) : \"?\") + params;\n  }\n\n  function addToPath(url, segment){\n    return url + (url.match(/\\/$/) ? \"\" : \"/\") + segment;\n  }\n\n  function cacheBust(url){\n    return addParamToUrl(url, \"cacheKey\", Math.floor(Math.random()*Math.pow(2,53)));\n  }\n\n  function ajax(url, object, method, callback){\n    var xhr = new XMLHttpRequest();\n    \n    var isPost = (method === \"POST\");\n    var data = null;\n    \n    if(object){\n\n      if(isPost){\n        data = dataToParams(object);\n      } else {\n        url = addParamsToUrl(url, object);\n      }\n    }\n    \n    if(isPost){\n      url = cacheBust(url);\n    }\n\n    xhr.open(method, url, true);\n    \n    if(isPost && data){\n      xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    }\n    \n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    \n    xhr.onreadystatechange = function(){\n      if(xhr.readyState == 4){\n        callback(xhr);\n      }\n    }\n    \n    xhr.send(data);\n    return xhr;\n  }\n\n  ajax.addParamToUrl = addParamToUrl;\n  ajax.addParamsToUrl = addParamsToUrl;\n  ajax.addToPath = addToPath;\n  ajax.cacheBust = cacheBust;\n\n\n  return ajax;\n});\n",
    "define('deco/qvc/ConstraintResolver',[], function(){\r\n\r\n  var STATE_LOADING = 'loading';\r\n  var STATE_LOADED = 'loaded';\r\n\r\n  function findConstraint(name, constraints) {\r\n    for (var i = 0; i < constraints.length; i++) {\r\n      if (constraints[i].name == name) {\r\n        return constraints[i];\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function constraintsLoaded(name, fields){\r\n    var constraint = findConstraint(name, this.constraints);\r\n    if(constraint){\r\n      constraint.validatables.forEach(function(validatable){\r\n        validatable.applyConstraints(fields);\r\n      });\r\n      constraint.fields = fields;\r\n      constraint.state = STATE_LOADED;\r\n      constraint.validatables = [];\r\n    }\r\n  }\r\n\r\n\r\n  function ConstraintResolver(qvc){\r\n    this.qvc = qvc;\r\n    this.constraints = [];\r\n  }\r\n  \r\n  ConstraintResolver.prototype.applyValidationConstraints = function(name, validatable){\r\n    var constraint = findConstraint(name, this.constraints);\r\n    if(constraint === false){\r\n      this.constraints.push({\r\n        name: name,\r\n        state: STATE_LOADING,\r\n        validatables: [validatable]\r\n      });\r\n      this.qvc.loadConstraints(name, constraintsLoaded.bind(this));\r\n    }else{\r\n      if(constraint.state === STATE_LOADING){\r\n        constraint.validatables.push(validatable);\r\n      }else{\r\n        validatable.applyConstraints(constraint.fields);\r\n      }\r\n    }\r\n  };\r\n  \r\n  return ConstraintResolver;\r\n});\n",
    "define('deco/errorHandler',[], function(){\r\n  return {\r\n    onError: function(error){\r\n      setTimeout(function(){\r\n        throw error;\r\n      },1);\r\n    }\r\n  };\r\n});\n",
    "define('deco/qvc',[\n  \"deco/qvc/Executable\", \n  \"deco/qvc/ExecutableResult\", \n  \"deco/utils\", \n  \"deco/ajax\",\n  \"deco/qvc/ConstraintResolver\",\n  \"deco/errorHandler\",\n  \"knockout\", \n  \"deco/qvc/koExtensions\"], \n  function(\n    Executable,\n    ExecutableResult,\n    utils,\n    ajax,\n    ConstraintResolver,\n    errorHandler,\n    ko){\n  \n  function QVC(){\n\n    var qvc = this;\n\n    this.constraintResolver = new ConstraintResolver(qvc);\n\n    this.execute = function(executable){\n      var parameters = ko.toJS(executable.parameters);\n      var data = {\n        parameters: JSON.stringify(parameters),\n        csrfToken: qvc.config.csrf\n      };\n      var url = ajax.addToPath(qvc.config.baseUrl, executable.type + \"/\" + executable.name);\n      ajax(url, data, \"POST\", function (xhr) {\n        if (xhr.status === 200) {\n          executable.result = new ExecutableResult(JSON.parse(xhr.responseText || \"{}\"));\n          if (executable.result.success === true) {\n            executable.onSuccess();\n          } else {\n            if(executable.result.exception && executable.result.exception.message){\n              errorHandler.onError(executable.result.exception.message);\n            }\n            executable.onError();\n          }\n        } else {\n          executable.result = new ExecutableResult({exception: {message: xhr.responseText, cause: xhr}});\n          errorHandler.onError(executable.result.exception.message);\n          executable.onError();\n        }\n        executable.onComplete();\n      });\n    \n    };\n    \n    this.loadConstraints = function(name, callback){\n      var url = ajax.addToPath(qvc.config.baseUrl, \"constraints/\" + name);\n      ajax(url, null, \"GET\", function(xhr){\n        if (xhr.status === 200) {\n          try{\n            var response = JSON.parse(xhr.responseText || \"{\\\"parameters\\\":[]}\");\n            if(\"parameters\" in response == false){\n              response.parameters = [];\n            }\n            if(response.exception && response.exception.message){\n              errorHandler.onError(response.exception.message);\n            }\n          }catch(e){\n            var response = {parameters: []};\n          }\n          callback(name, response.parameters);\n        }else{\n          errorHandler.onError(xhr.responseText);\n        }\n      });\n    };\n\n    \n    this.config = {\n      baseUrl: \"/\",\n      csrf: \"\"\n    }\n  };\n\n  var qvc = new QVC();\n  \n  function createExecutable(name, type, parameters, callbacks){  \n    var executable = new Executable(name, type, parameters || {}, callbacks || {}, qvc);\n    var execute = executable.execute.bind(executable);\n    execute.isValid = ko.computed(executable.isValid, executable);\n    execute.isBusy = ko.computed(executable.isBusy, executable);\n    execute.hasError = ko.computed(executable.hasError, executable);\n    execute.success = function(callback){\n      executable.hooks.success = callback;\n      return execute;\n    };\n    execute.error = function(callback){\n      executable.hooks.error = callback;\n      return execute;\n    };\n    execute.invalid = function(callback){\n      executable.hooks.invalid = callback;\n      return execute;\n    };\n    execute.beforeExecute = function(callback){\n      executable.hooks.beforeExecute = callback;\n      return execute;\n    };\n    execute.canExecute = function(callback){\n      executable.hooks.canExecute = callback;\n      return execute;\n    };\n    execute.result = function(){\n      if(arguments.length == 1){\n        executable.hooks.result = arguments[0];\n        return execute;\n      }\n      return executable.result.result;\n    };\n    execute.complete = function(callback){\n      executable.hooks.complete = callback;\n      return execute;\n    };\n    execute.clearValidationMessages = executable.clearValidationMessages.bind(executable);\n    execute.validator = executable.validator;\n    execute.parameters = executable.parameters;\n    execute.validate = executable.validate.bind(executable);\n    \n    return execute;\n  }\n  \n  return {\n    createCommand: function(name, parameters, hooks){\n      if(name == null || name.length == 0)\n        throw new Error(\"Command is missing name\\nA command must have a name!\\nusage: createCommand('name', [parameters, hooks])\");\n      return createExecutable(name, Executable.Command, parameters, hooks);\n    },\n    createQuery: function(name, parameters, hooks){\n      if(name == null || name.length == 0)\n        throw new Error(\"Query is missing name\\nA query must have a name!\\nusage: createQuery('name', [parameters, hooks])\");\n      return createExecutable(name, Executable.Query, parameters, hooks);\n    },\n    config: function(config){\n      utils.extend(qvc.config, config);\n    }\n  }\n});\n",
    "define('deco/spa/Outlet',[\r\n  \"knockout\"\r\n], function(\r\n  ko\r\n){\r\n\r\n  function Outlet(element, document){\r\n    this.element = element;\r\n    this.document = document || window.document;\r\n  }\r\n\r\n  Outlet.prototype.outletExists = function(){\r\n    return this.element != null;\r\n  };\r\n\r\n  Outlet.prototype.unloadCurrentPage = function(){\r\n    ko.cleanNode(this.element);\r\n    this.element.innerHTML = \"\";\r\n  };\r\n\r\n  Outlet.prototype.setPageContent = function(content){\r\n    this.element.innerHTML = content;\r\n  };\r\n\r\n  Outlet.prototype.getPageTitle = function(){\r\n    var titleMetaTag = this.element.querySelector(\"meta[name=title]\");\r\n    return (titleMetaTag && titleMetaTag.getAttribute(\"content\"));\r\n  };\r\n\r\n  Outlet.prototype.setDocumentTitle = function(title){\r\n    this.document.title = title;\r\n  };\r\n\r\n  Outlet.prototype.extractAndRunPageJavaScript = function(){\r\n    var scripts = this.element.querySelectorAll(\"script[type='text/javascript']\");\r\n    for(var i=0; i<scripts.length; i++){\r\n      scripts[i].parentNode.removeChild(scripts[i]);\r\n      if(scripts[i].id === '') throw new Error(\"The script must have an id\");\r\n      if(this.document.getElementById(scripts[i].id) == null){\r\n        var script = this.document.createElement(\"script\");\r\n        script.id = scripts[i].id;\r\n        script.text = scripts[i].textContent;\r\n        script.setAttribute('type', scripts[i].getAttribute('type'));\r\n        this.document.body.appendChild(script);\r\n      }\r\n    }\r\n  };\r\n\r\n  Outlet.prototype.indicatePageIsLoading = function(){\r\n    this.element.setAttribute(\"data-loading\", \"true\");\r\n  };\r\n\r\n  Outlet.prototype.pageHasLoaded = function(){\r\n    this.element.setAttribute(\"data-loading\", \"false\");\r\n  };\r\n\r\n  return Outlet;\r\n\r\n});\n",
    "define('deco/spa/whenContext',[\r\n  \r\n], function(\r\n  \r\n){\r\n\r\n  function unsubscribe(event, reaction){\r\n    event.dont(reaction);\r\n  }\r\n\r\n  function subscribe(event, reaction){\r\n    event(reaction);\r\n    return event.dont.bind(null, reaction);\r\n  }\r\n\r\n  function whenSomething(){\r\n    if(this.destroyed) throw new Error(\"This context has been destroyed!\");\r\n\r\n    if(arguments.length == 0){\r\n      var childContext = createContext();\r\n      this.childContexts.push(childContext);\r\n      return childContext.when;\r\n    }else if(arguments.length == 1 && typeof arguments[0] === \"function\"){\r\n      return {\r\n        dont: unsubscribe.bind(null, arguments[0])\r\n      }\r\n    }else if(arguments.length == 2 && typeof arguments[1] === \"function\"){\r\n      this.eventSubscribers.push(subscribe(arguments[0], arguments[1]));\r\n    }\r\n  }\r\n\r\n  function thisIsDestroyed(reaction){\r\n    this.onDestroyListeners.push(reaction);\r\n  }\r\n\r\n  function destroyChildContexts(){\r\n    var context;\r\n    while(context = this.childContexts.pop())\r\n      context.destroyContext();\r\n  }\r\n\r\n  function destroyContext(){\r\n    var subscriber, listener, context;\r\n    while(subscriber = this.eventSubscribers.pop())\r\n      subscriber();\r\n    while(listener = this.onDestroyListeners.pop())\r\n      listener();\r\n    while(context = this.childContexts.pop())\r\n      context.destroyContext();\r\n    this.destroyed = true;\r\n  }\r\n\r\n  function createContext(){\r\n    var context = {\r\n      destroyed: false,\r\n      onDestroyListeners: [],\r\n      childContexts: [],\r\n      eventSubscribers: []\r\n    };\r\n\r\n    var when = whenSomething.bind(context);\r\n\r\n    when.thisIsDestroyed = thisIsDestroyed.bind(context);\r\n\r\n    when.destroyChildContexts = destroyChildContexts.bind(context);\r\n\r\n    return {\r\n      when: when,\r\n      destroyContext: destroyContext.bind(context)\r\n    };\r\n  }\r\n\r\n  return createContext().when;\r\n});\n",
    "define('deco/spa/viewModelFactory',[\n  \"deco/errorHandler\"\n], function(\n  errorHandler\n) {\n  return {\n    getViewModelFromAttributes: function(target){\n      var viewModelName = target.getAttribute(\"data-viewmodel\");\n      var model = target.getAttribute(\"data-model\");\n\n      return {\n        target: target,\n        viewModelName: viewModelName,\n        model: model\n      };\n    },\n    \n    getParentViewModelElement: function(element, maxAncestor){\n      while(element = element.parentNode){\n        if(element === maxAncestor) return null;\n        if(element.hasAttribute(\"data-viewmodel\")) return element;\n      }\n      return null;\n    },\n    \n    loadViewModel: function(data){\n      return new Promise(function(resolve, reject){\n        require([data.viewModelName], resolve, reject);\n      }).then(function(ViewModel){\n        return {\n          viewModelName: data.viewModelName,\n          ViewModel: ViewModel,\n          model: data.model,\n          target: data.target\n        }\n      }, function(error){\n        errorHandler.onError(new Error(\"Could not load the following modules:\\n\"+error.requireModules.join(\"\\n\")));\n        return null;\n      });\n    },\n\n    createViewModel: function(data, subscribe, params) {\n      var model = (data.model && (data.model.charAt(0) == '{' || data.model.charAt(0) == '['))\n        ? JSON.parse(data.model)\n        : params;\n      var whenContext = subscribe();\n      var viewModel = new data.ViewModel(model, whenContext);\n      viewModel['@SymbolDecoWhenContext'] = whenContext;\n      return {\n        viewModelName: data.viewModelName,\n        viewModel: viewModel,\n        target: data.target\n      }\n    }\n  }\n});\n",
    "define('deco/spa/extendKnockout',[\n  \"deco/spa/viewModelFactory\",\n  \"deco/errorHandler\",\n  \"knockout\"\n], function(\n  viewModelFactory,\n  errorHandler,\n  ko\n){\n    \n  var nativeBindingProviderInstance = new ko.bindingProvider();\n  var originalBindingProvider = ko.bindingProvider.instance;\n\n  ko.bindingProvider.instance = {\n    nodeHasBindings: function(node){\n      return hasViewModel(node) || originalBindingProvider.nodeHasBindings(node);\n    },\n    getBindingAccessors: function(node, context){\n      if(hasViewModel(node)){\n        return {\n          '@SymbolDecoApplyViewModel': function(){ return null; }\n        };\n       }else{\n         return originalBindingProvider.getBindingAccessors(node, context);\n       }\n    }\n  };\n\n\n  ko.bindingHandlers['@SymbolDecoApplyViewModel'] = {\n    init: function(element, valueAccessor, allBindingsAccessor, deprecated, parentContext){\n      var parentViewModel = viewModelFactory.getParentViewModelElement(element)['@SymbolDecoViewModel'];\n      var whenContext = parentViewModel['@SymbolDecoWhenContext']();\n      try{\n      var params = getComponentParamsFromCustomElement(element, parentContext);\n      }catch(e){\n        console.error(e.stack);\n      }\n      Promise.resolve(viewModelFactory.getViewModelFromAttributes(element))\n      .then(function(data){\n        return viewModelFactory.loadViewModel(data)\n      }).then(function(data){\n        return viewModelFactory.createViewModel(data, whenContext, params);\n      }).then(function(data){\n        data.target['@SymbolDecoViewModel'] = data.viewModel;\n        \n        var childContext = parentContext.createChildContext(data.viewModel);\n        ko.utils.domData.clear(data.target);\n        ko.applyBindings(childContext, data.target);\n        \n        ko.utils.domNodeDisposal.addDisposeCallback(data.target, function() {\n          delete data.target['@SymbolDecoViewModel'];\n          whenContext.destroyChildContexts();\n        });\n      })['catch'](errorHandler.onError);\n\n      return {\n        controlsDescendantBindings: true\n      };\n    }\n  };\n  \n  //this is stolen from the knockout sourcecode, and I had to copy it since it's not exposed as a public api\n\n  function getComponentParamsFromCustomElement(elem, bindingContext) {\n    var paramsAttribute = elem.getAttribute('data-params');\n\n    if (!paramsAttribute) {\n      return undefined;\n    }\n    \n    var params = nativeBindingProviderInstance['parseBindingsString'](paramsAttribute, bindingContext, elem, { 'valueAccessors': true, 'bindingParams': true });\n    var rawParamComputedValues = Object.create(null);\n    for(paramName in params) {\n      var paramValue = params[paramName];\n      rawParamComputedValues[paramName] = ko.computed(paramValue, null, { disposeWhenNodeIsRemoved: elem });\n    }\n    var result = Object.create(null);\n    for(paramName in rawParamComputedValues) {\n      var paramValueComputed = rawParamComputedValues[paramName];\n      var paramValue = paramValueComputed.peek();\n      // Does the evaluation of the parameter value unwrap any observables?\n      if (!paramValueComputed.isActive()) {\n        // No it doesn't, so there's no need for any computed wrapper. Just pass through the supplied value directly.\n        // Example: \"someVal: firstName, age: 123\" (whether or not firstName is an observable/computed)\n        result[paramName] = paramValue;\n      } else {\n        // Yes it does. Supply a computed property that unwraps both the outer (binding expression)\n        // level of observability, and any inner (resulting model value) level of observability.\n        // This means the component doesn't have to worry about multiple unwrapping. If the value is a\n        // writable observable, the computed will also be writable and pass the value on to the observable.\n        result[paramName] = ko.computed({\n          'read': function() {\n            return ko.unwrap(paramValueComputed());\n          },\n          'write': ko.isWriteableObservable(paramValue) && function(value) {\n            paramValueComputed()(value);\n          },\n          disposeWhenNodeIsRemoved: elem\n        });\n      }\n    }\n    return result;\n  }\n  \n  function hasViewModel(node){\n    return node.nodeType === 1 && node.hasAttribute(\"data-viewmodel\") && !('@SymbolDecoViewModel' in node);\n  }\n});\n",
    "define('deco/spa/applyViewModels',[\n  \"deco/utils\",\n  \"deco/errorHandler\",\n  \"deco/spa/viewModelFactory\",\n  \"knockout\",\n  \"deco/spa/extendKnockout\"\n], function (\n  utils, \n  errorHandler,\n  viewModelFactory,\n  ko\n) {\n\n  function applyViewModel(data) {\n    data.target['@SymbolDecoViewModel'] = data.viewModel;\n    ko.applyBindings(data.viewModel, data.target);\n  }\n\n  function viewModelLoadedSuccessfully(data){\n    return data != null && data.ViewModel != null;\n  }\n\n  return function (domElement, subscribe) {\n    domElement = domElement || document.body;\n\n    var viewModelsLoaded = utils.toArray(domElement.querySelectorAll(\"[data-viewmodel]\"))\n    .filter(function(element){\n      return viewModelFactory.getParentViewModelElement(element, domElement) ? false : true;\n    })\n    .map(viewModelFactory.getViewModelFromAttributes)\n    .map(viewModelFactory.loadViewModel);\n\n    return Promise.all(viewModelsLoaded).then(function(list){\n      list\n        .filter(viewModelLoadedSuccessfully)\n        .map(function(data){\n          return viewModelFactory.createViewModel(data, subscribe);\n        })\n        .forEach(applyViewModel);\n    })['catch'](errorHandler.onError);\n  };\n});\n",
    "define('deco/spa/hashNavigation',[\n  \"deco/utils\"\n],function(\n  _\n){\n\n\n  \n  function findNewPath(currentPath, link, index){\n    var isRelative = _.startsWith(link, '/') === false;\n    var isFolder = _.endsWith(link, '/');\n    \n    if(link === \"/\"){\n      var path = [];\n    }else if(link === \"\"){\n      var path = [index];\n    }else{\n      var path = _.trim(link, \"/\").split(\"/\");\n    }\n\n    if(isFolder){\n      path.push(index);\n    }\n    if(isRelative){\n      path = _.popTail(currentPath).concat(path);\n    }\n\n    var out = [];\n    var isPretty = true;\n    var segmentsToSkip = 0;\n\n    for(var i = path.length-1; i>=0; i--){\n      if(path[i] === \"\"){\n        isPretty = false;\n      }else if(path[i] === \".\"){\n        isPretty = false;\n      }else if(path[i] === \"..\") {\n        isPretty = false;\n        segmentsToSkip++;\n      }else if(segmentsToSkip > 0){\n        segmentsToSkip--;\n      }else{\n        out.unshift(path[i]);\n      }\n    }\n\n    return {isAbsoluteAndPretty: !isFolder && !isRelative && isPretty, path: out};\n  }\n\n  function hashChanged(config, onPageChanged, document){\n    var link = _.after(document.location.href, '#');\n    var isHashBang = _.startsWith(link, '!');\n    var result = findNewPath(this.currentPath, link.substr(isHashBang ? 1 : 0), config.index);\n    \n    if(result.isAbsoluteAndPretty && isHashBang){\n      this.currentPath = result.path;\n      onPageChanged(result.path.join('/'), result.path.map(decodeURIComponent));\n    }else{\n      document.location.replace(\"#!/\" + result.path.join('/'));\n    }\n\n  }\n  \n  function startHashNavigation(config, onPageChanged, doc, global){\n    doc = doc || document;\n    global = global || window;\n\n    var state = {\n      currentPath: []\n    };\n    var onHashChanged = hashChanged.bind(state, config, onPageChanged, doc);\n    onHashChanged();\n    _.addEventListener(global, \"hashchange\", onHashChanged, false);\n\n    return {\n      stop: function(){\n        global.removeEventListener(\"hashchange\", onHashChanged, false);\n      }\n    };\n  }\n\n\n  return {\n    start: startHashNavigation\n  };\n\n});\n",
    "define('deco/spa/PageLoader',[\n  \"deco/ajax\"\n], function(\n  ajax\n){\n\n  function PageLoader(config){\n    this.pathToUrl = config && config.pathToUrl || function(a){ return a; };\n    this.cache = (config && 'cachePages' in config ? config.cachePages : true);\n    this.currentXHR = null;\n  }\n\n  PageLoader.prototype.loadPage = function(path){\n\n    this.abort();\n\n    var url = this.pathToUrl(path);\n\n    if(this.cache === false)\n      url = ajax.cacheBust(url);\n    \n    var self = this;\n    return new Promise(function(resolve, reject){\n      self.currentXHR = ajax(url, {}, \"GET\", function(xhr){\n        self.currentXHR = null;\n        if(xhr.status === 200){\n          resolve(xhr.responseText);\n        }else{\n          reject({error: xhr.status, content: xhr.responseText});\n        }\n      });\n    });\n  };\n\n  PageLoader.prototype.abort = function(){\n    if(this.currentXHR && this.currentXHR.readyState !== 4){\n      this.currentXHR.abort();\n    }\n  };\n\n  return PageLoader;\n});\n",
    "define('deco/spa/Templates',[\n  \"deco/spa/PageLoader\",\n  \"deco/utils\"\n], function(\n  PageLoader,\n  utils\n){\n\n  function defaultConfig(){\n    return {\n      pathToUrl: function(a){ return a; }\n    }\n  }\n\n  function findTemplatesInDocument(doc){\n\n    var nodeList = doc.querySelectorAll(\"[type='text/page-template']\");\n    var nodes = utils.toArray(nodeList);\n    var templateList = nodes.map(function(template){\n      return {\n        id: template.id.toLowerCase(),\n        content: template.innerHTML\n      };\n    });\n\n    return utils.arrayToObject(templateList, function(item, object){\n      object[item.id] = item.content;\n    });\n  }\n\n\n  function Templates(document, config){\n    this.pageLoader = new PageLoader(config || defaultConfig());\n    this.cachePages = (config && 'cachePages' in config ? config.cachePages : true)\n    this.templates = findTemplatesInDocument(document);\n  }\n\n  Templates.prototype.getTemplate = function(path){\n\n    this.pageLoader.abort();\n\n    var normalizedPath = path.toLowerCase();\n\n    if(normalizedPath in this.templates){\n      return Promise.resolve(this.templates[normalizedPath]);\n    }else{\n      return this.pageLoader.loadPage(path)\n      .then(function(content){\n        if(this.cachePages)\n          this.templates[normalizedPath] = content;\n        \n        return content;\n      }.bind(this), function(notFound){\n        var errorTemplate = \"error\" + notFound.error;\n        if(errorTemplate in this.templates){\n          return this.templates[errorTemplate];\n        }else{\n          return notFound.content;\n        }\n      }.bind(this));\n    }\n  };\n\n  return Templates;\n});\n",
    "define('deco/proclaimWhen',[], function () {\r\n\r\n  function publish(name, subscribers, data) {\r\n    subscribers.forEach(function (item) {\r\n      item.apply(item, data);\r\n    });\r\n  }\r\n\r\n  function subscribeTo(name, subscribers, subscriber) {\r\n    var index = subscribers.indexOf(subscriber);\r\n    if(index < 0)\r\n      subscribers.push(subscriber);\r\n    return index < 0;\r\n  }\r\n  \r\n  function unsubscribeFrom(name, subscribers, subscriber){\r\n    var index = subscribers.indexOf(subscriber);\r\n    if(index >= 0)\r\n      subscribers.splice(index, 1);\r\n    return index >= 0;\r\n  }\r\n  function extendEvent(name, event){\r\n    event.subscribers = [];\r\n    event.subscribeSubscribers = [];\r\n    event.unsubscribeSubscribers = [];\r\n\r\n    var extendedEvent = function(){\r\n      if(arguments.length == 1 && typeof arguments[0] === \"function\"){\r\n        if(subscribeTo(name, event.subscribers, arguments[0]))\r\n          publish(name+\".isSubscribedTo\", event.subscribeSubscribers);\r\n      }else{\r\n        publish(name, event.subscribers, arguments);\r\n      }\r\n    }\r\n\r\n    extendedEvent.dont = function(subscriber){\r\n      if(unsubscribeFrom(name, event.subscribers, subscriber))\r\n        publish(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers);\r\n    };\r\n\r\n    extendedEvent.isSubscribedTo = function(subscriber){\r\n      subscribeTo(name+\".isSubscribedTo\", event.subscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isSubscribedTo.dont = function(subscriber){\r\n      unsubscribeFrom(name+\".isSubscribedTo\", event.subscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isUnsubscribedFrom = function(subscriber){\r\n      subscribeTo(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isUnsubscribedFrom.dont = function(subscriber){\r\n      unsubscribeFrom(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.toString = function(){\r\n      return \"[Event \"+name+\"]\";\r\n    }\r\n\r\n    return extendedEvent;\r\n  }\r\n  \r\n  function extend(events){\r\n    for(var i in events){\r\n      events[i] = extendEvent(i, events[i]);\r\n    }\r\n    return events;\r\n  }\r\n\r\n  function create(arg1, arg2){\r\n    if(arg2)\r\n      return extendEvent(arg1, arg2);\r\n    else\r\n      return extendEvent(\"anonymous event\", arg1)\r\n  }\r\n\r\n  return {\r\n    extend: extend,\r\n    create: create\r\n  };\r\n  \r\n});\r\n\n",
    "define('deco/events',['deco/proclaimWhen'], function(proclaimWhen){\r\n  return proclaimWhen.extend({\r\n    thePageHasChanged: function(path, segments, url){ }\r\n  });\r\n});\n",
    "define('deco/spa',[\n  \"deco/spa/Outlet\",\n  \"deco/spa/whenContext\",\n  \"deco/spa/applyViewModels\",\n  \"deco/spa/hashNavigation\",\n  \"deco/spa/Templates\",\n  \"deco/utils\",\n  \"deco/events\",\n  \"deco/errorHandler\"\n], function(\n  Outlet,\n  whenContext,\n  applyViewModels,\n  hashNavigation,\n  Templates,\n  utils,\n  proclaim,\n  errorHandler\n){\n\n  var _config = {\n      index: \"index\"\n    },\n    _document,\n    _outlet,\n    _originalTitle,\n    _templates,\n    _whenContext;\n\n  function applyContent(content){\n    _outlet.unloadCurrentPage();\n    _outlet.setPageContent(content);\n    _outlet.setDocumentTitle(_outlet.getPageTitle() || _originalTitle);\n    _outlet.extractAndRunPageJavaScript();\n    return applyViewModels(_outlet.element, _whenContext());\n  }\n\n  function pageChanged(path, segments){\n    _outlet.indicatePageIsLoading();\n    _whenContext.destroyChildContexts();\n    return _templates.getTemplate(path)\n      .then(applyContent)\n      .then(function(){\n        _outlet.pageHasLoaded();\n        proclaim.thePageHasChanged(path, segments, document.location)\n      })['catch'](errorHandler.onError);;\n  }\n\n  function start(config, document){\n    _document = document || window.document;\n    _config = utils.extend(_config, config);\n    _outlet = new Outlet(_document.querySelector(\"[data-outlet]\"), _document);\n    _originalTitle = _document.title;\n    _whenContext = whenContext();\n\n    return applyViewModels(_document, whenContext()).then(function(){\n      if(_outlet.outletExists()){\n        _templates = new Templates(_document, _config);\n        hashNavigation.start(_config, pageChanged, _document);\n      }\n    });\n  }\n\n  return {\n    start: start\n  };\n});\n",
    "define('deco/deco',[\r\n  'deco/qvc',\r\n  'deco/spa'\r\n], function(\r\n  qvc,\r\n  spa\r\n){\r\n\r\n  \r\n\r\n  function config(config){\r\n\r\n    config = config || {};\r\n\r\n    var spaConfig = config.spa || {};\r\n    var qvcConfig = config.qvc || {};\r\n\r\n    qvc.config(qvcConfig);\r\n\r\n    return {\r\n      start: spa.start.bind(null, spaConfig, document)\r\n    }\r\n  }\r\n  \r\n  return {\r\n    config: config\r\n  };\r\n\r\n});\ndefine('deco', ['deco/deco'], function (main) { return main; });\n\n",
    "define('deco/qvc/constraints/NotEmpty',[], function(){\r\n  function NotEmpty(attributes){\r\n    \r\n  }\r\n  \r\n  NotEmpty.prototype.isValid = function(value){\r\n    if(value == null) return false;\r\n    if(typeof value == \"string\" && value.length == 0) return false;\r\n    return true;\r\n  };\r\n  \r\n  return NotEmpty;\r\n});\n",
    "define('deco/qvc/constraints/Pattern',[], function(){\r\n  function Pattern(attributes){    \r\n\r\n    attributes.flags = attributes.flags || [];\r\n    \r\n    var flags = '';\r\n    if(attributes.flags.indexOf(\"CASE_INSENSITIVE\") >= 0) flags += 'i';\r\n    \r\n    this.regex = new RegExp(attributes.regexp, flags);\r\n  }\r\n  \r\n  \r\n  Pattern.prototype.isValid = function(value){\r\n    \r\n    if(value == null) return false;\r\n    \r\n    var result = this.regex.exec(value);\r\n    \r\n    if(result == null) return false;\r\n    \r\n    return result[0] == value;\r\n  };\r\n  \r\n  \r\n  return Pattern;\r\n});\n"
  ]
}