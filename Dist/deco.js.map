{
  "version": 3,
  "file": "Dist/deco.js",
  "sources": [
    "Source/deco/utils.js",
    "Source/deco/qvc/ExecutableResult.js",
    "Source/deco/qvc/Constraint.js",
    "Source/deco/qvc/Validator.js",
    "Source/deco/qvc/koExtensions.js",
    "Source/deco/qvc/Validatable.js",
    "Source/deco/qvc/Executable.js",
    "Source/deco/ajax.js",
    "Source/deco/qvc/ConstraintResolver.js",
    "Source/deco/errorHandler.js",
    "Source/deco/qvc.js",
    "Source/deco/spa/Outlet.js",
    "Source/deco/spa/whenContext.js",
    "Source/deco/spa/viewModelFactory.js",
    "Source/deco/spa/extendKnockout.js",
    "Source/deco/spa/applyViewModels.js",
    "Source/deco/spa/hashNavigation.js",
    "Source/deco/spa/PageLoader.js",
    "Source/deco/spa/Templates.js",
    "Source/deco/proclaimWhen.js",
    "Source/deco/events.js",
    "Source/deco/spa.js",
    "Source/deco/deco.js",
    "Source/deco/qvc/constraints/NotEmpty.js",
    "Source/deco/qvc/constraints/Pattern.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA,AD4EA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA,ADeA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA,ADyBA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvKA,ADwKA;ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA,ADsFA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnDA,ADoDA;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA,AD0EA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA,ADwDA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5GA,AD6GA;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtFA,ADuFA;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA,ADiEA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnFA,ADoFA;ACnFA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA,ADmEA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "sourcesContent": [
    "define('deco/utils',[], function(){\r\n  return {\r\n    \r\n    toArray: function(obj){\r\n      var array = [];\r\n      // iterate backwards ensuring that length is an UInt32\r\n      for (var i = obj.length >>> 0; i--;) { \r\n        array[i] = obj[i];\r\n      }\r\n      return array;\r\n    },\r\n    \r\n    extend: function(dst, src){\r\n      src = src || {};\r\n      dst = dst || {};\r\n      for(var i in src){\r\n        dst[i] = src[i];\r\n      }\r\n      return dst;\r\n    },\r\n    \r\n    inheritsFrom: function(o){\r\n      function F() {}\r\n      F.prototype = o.prototype;\r\n\r\n      return new F();\r\n    },\r\n    \r\n    arrayToObject: function(array, func){\r\n      return array.reduce(function(collection, item){\r\n        func(item, collection);\r\n        return collection;\r\n      }, {});\r\n    },\r\n    \r\n    trim: function(word, character){\r\n      for(var f=0; f<word.length; f++){\r\n        if(word.charAt(f) !== character) break;\r\n      }\r\n      for(var t=word.length; t>0; t--){\r\n        if(word.charAt(t-1) !== character) break;\r\n      }\r\n      return word.substring(f, t);\r\n    },\r\n    \r\n    after: function(word, character){\r\n      var index = word.indexOf(character);\r\n      if(index < 0){\r\n        return \"\";\r\n      }else{\r\n        return word.substr(index+1);\r\n      }\r\n    },\r\n    \r\n    popTail: function(array){\r\n      return array.slice(0, -1);\r\n    },\r\n    \r\n    startsWith: function(word, character){\r\n      return word.charAt(0) === character;\r\n    },\r\n    \r\n    endsWith: function(word, character){\r\n      return word.charAt(word.length - 1) === character;\r\n    },\r\n    \r\n    addEventListener: function(element, event, listener, bubble){\r\n      if('addEventListener' in element){\r\n        element.addEventListener(event, listener, bubble);\r\n      }else{\r\n        element.attachEvent(\"on\"+event, listener);    \r\n      }\r\n    }\r\n  };\r\n});\r\n\n",
    "define('deco/qvc/ExecutableResult',[\"deco/utils\"], function(utils){\r\n  function ExecutableResult(result){\r\n    \r\n    this.success = false;\r\n    this.valid = false;\r\n    this.result = null;\r\n    this.exception = null;\r\n    this.violations = [];\r\n  \r\n    utils.extend(this, result);\r\n  \r\n  };\r\n  \r\n  return ExecutableResult;\r\n});\n",
    "define('deco/qvc/Constraint',[], function(){\r\n  \r\n  function Constraint(type, attributes){    \r\n    this.type = type;\r\n    this.attributes = attributes;\r\n    this.message = attributes.message;\r\n    \r\n    \r\n    this.init(type);\r\n  }\r\n    \r\n  Constraint.prototype.init = function(type){\r\n    require([\"deco/qvc/constraints/\" + type], function(Tester){\r\n      var tester = new Tester(this.attributes);\r\n      this.validate = tester.isValid.bind(tester);\r\n    }.bind(this));\r\n  };\r\n  \r\n  Constraint.prototype.validate = function(value){\r\n    return true;//real test not loaded yet\r\n  };\r\n  \r\n  \r\n  return Constraint;\r\n});\n",
    "define('deco/qvc/Validator',[\r\n  \"deco/qvc/Constraint\", \r\n  \"knockout\"\r\n], function(\r\n  Constraint, \r\n  ko\r\n){\r\n\r\n  function interpolate(message, attributes, value, name, path){\r\n    return message.replace(/\\{([^}]+)\\}/g, function(match, key){\r\n      if(key == \"value\") return value;\r\n      if(key == \"this.name\") return name;\r\n      if(key == \"this.path\") return path;\r\n      if(key in attributes) return attributes[key];\r\n      return match;\r\n    });\r\n  }\r\n  \r\n\r\n  function Validator(target, options){\r\n    var self = this;\r\n    \r\n    this.constraints = [];\r\n    \r\n    this.isValid = ko.observable(true);\r\n    this.message = ko.observable(\"\");\r\n\r\n    this.name = options && options.name;\r\n    this.path = options && options.path;\r\n    this.executableName = options && options.executableName;\r\n    \r\n    if(target && ko.isObservable(target)){\r\n      target.isValid = function(){return self.isValid();};\r\n    }\r\n  }\r\n  \r\n  Validator.prototype.setConstraints = function(constraints){\r\n    this.constraints = constraints.map(function(constraint){\r\n      return new Constraint(constraint.name, constraint.attributes);\r\n    });\r\n  };\r\n  \r\n  Validator.prototype.reset = function(){\r\n    this.isValid(true);\r\n    this.message(\"\");\r\n  };\r\n  \r\n  Validator.prototype.validate = function(value){\r\n    if(this.constraints.length == 0){\r\n      this.reset();\r\n    }else if(this.constraints.every(function (constraint) {\r\n      if(constraint.validate(value)){\r\n        return true;\r\n      }else{\r\n        this.isValid(false);\r\n        this.message(interpolate(constraint.message, constraint.attributes, value, this.name, this.path));\r\n        return false;\r\n      }\r\n    }.bind(this))){\r\n      this.isValid(true);\r\n      this.message(\"\");\r\n    }\r\n  };\r\n  \r\n  return Validator;\r\n});\n",
    "define('deco/qvc/koExtensions',[\"deco/qvc/Validator\", \"knockout\"], function(Validator, ko){\r\n\r\n  if (ko != null) {\r\n    ko.bindingHandlers.validationMessageFor = {\r\n      init: function (element, valueAccessor, allBindingsAccessor, viewModel) {\r\n        var value = valueAccessor();\r\n        var validator = value.validator;\r\n        if (validator) {\r\n          ko.applyBindingsToNode(element, { hidden: validator.isValid, text: validator.message }, validator);\r\n        }else{\r\n          var attributes = Array.prototype.reduce.call(element.attributes, function(s,e){return s+\" \"+e.localName+\"=\\\"\"+e.value+\"\\\"\"}, \"\");\r\n          throw new Error(\"Could not bind `validationMessageFor` to value on element <\"+element.tagName.toLowerCase() + attributes +\">\");\r\n        }\r\n      }\r\n    };\r\n    \r\n    ko.bindingHandlers.command = ko.bindingHandlers.query = {\r\n      init: function (element, valueAccessor, allBindingAccessor, viewModel) {\r\n        ko.applyBindingsToNode(element, { click: valueAccessor() }, viewModel);\r\n      }\r\n    };\r\n  }\r\n  \r\n\r\n});\n",
    "define('deco/qvc/Validatable',[\r\n  \"deco/utils\", \r\n  \"deco/qvc/Validator\", \r\n  \"knockout\", \r\n  \"deco/qvc/koExtensions\"\r\n], function(\r\n  utils, \r\n  Validator, \r\n  ko\r\n){\r\n  \r\n  function Validatable(name, parameters, constraintResolver){\r\n    var self = this;\r\n    \r\n    this.validator = new Validator();\r\n    this.validatableFields = [];\r\n    this.validatableParameters = parameters;\r\n    \r\n    \r\n    init: {\r\n      recursivlyExtendParameters(self.validatableParameters, self.validatableFields, [], name);\r\n      if(constraintResolver)\r\n        constraintResolver.applyValidationConstraints(name, self);\r\n    }\r\n  }\r\n  \r\n  Validatable.prototype.isValid = function () {\r\n    return this.validatableFields.every(function(constraint){\r\n      return constraint.validator && constraint.validator.isValid();\r\n    }) && this.validator.isValid();\r\n  };\r\n    \r\n  Validatable.prototype.applyViolations = function(violations){\r\n    violations.forEach(function(violation){\r\n      var message = violation.message;\r\n      var fieldName = violation.fieldName;\r\n      if (fieldName && fieldName.length > 0) {\r\n        //one of the fields violates a constraint\r\n        applyViolationMessageToField(this.validatableParameters, fieldName, message);\r\n      } else {\r\n        //the validatable violates a constraint\r\n        applyViolationMessageToValidatable(this, message);\r\n      }\r\n    }.bind(this));\r\n  };\r\n  \r\n  Validatable.prototype.applyConstraints = function(fields){\r\n    var parameters = this.validatableParameters;\r\n    \r\n    fields.forEach(function(field){\r\n      var fieldName = field.name;\r\n      var constraints = field.constraints;\r\n\r\n      if(constraints == null || constraints.length == 0)\r\n        return;\r\n      \r\n      var object = findField(fieldName, parameters, \"Error applying constraints to field\");\r\n      \r\n      if (ko.isObservable(object) && \"validator\" in object) {\r\n        object.validator.setConstraints(constraints);\r\n      } else {\r\n        throw new Error(\"Error applying constraints to field: \" + fieldName + \"\\n\" +\r\n          \"It is not an observable or is not extended with a validator. \\n\" +\r\n          fieldName + \"=`\" + ko.toJSON(object) + \"`\");\r\n      }\r\n    });\r\n  };\r\n  \r\n  Validatable.prototype.validate = function(){\r\n    this.validator.validate(true);\r\n    if (this.validator.isValid()) {\r\n      this.validatableFields.forEach(function(constraint){\r\n        var validator = constraint.validator;\r\n        if (validator) {\r\n          validator.validate(constraint());\r\n        }\r\n      });\r\n    }\r\n  };\r\n  \r\n  Validatable.prototype.clearValidationMessages = function () {\r\n    this.validator.reset();\r\n    this.validatableFields.forEach(function(constraint){\r\n      var validator = constraint.validator;\r\n      if (validator) {\r\n        validator.reset();\r\n      }\r\n    });\r\n  };\r\n  \r\n  \r\n  \r\n  function recursivlyExtendParameters(parameters, validatableFields, parents, executableName) {\r\n    for (var key in parameters) {\r\n      var property = parameters[key];\r\n      var path = parents.concat([key]);\r\n      if (ko.isObservable(property)) {        \r\n        validatableFields.push(applyValidatorTo(property, key, path, executableName));\r\n      }\r\n      property = ko.utils.unwrapObservable(property);\r\n      if (typeof property === \"object\") {\r\n        recursivlyExtendParameters(property, validatableFields, path, executableName);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  function findField(fieldPath, parameters, errorMessage){\r\n    return fieldPath.split(\".\").reduce(function(object, name){\r\n      var path = object.path;\r\n      var field = ko.utils.unwrapObservable(object.field);\r\n      if (name in field) {\r\n        return {\r\n          field: field[name],\r\n          path: path + \".\" + name\r\n        };\r\n      } else {\r\n        throw new Error(errorMessage + \": \" + fieldPath + \"\\n\" +\r\n          name + \" is not a member of \" + path + \"\\n\" +\r\n          path + \" = `\" + ko.toJSON(field) + \"`\");\r\n      }\r\n    }, {\r\n      field: parameters,\r\n      path: \"parameters\"\r\n    }).field;\r\n  }\r\n\r\n\r\n\r\n  \r\n  function applyViolationMessageToField(parameters, fieldPath, message) {\r\n    var object = findField(fieldPath, parameters, \"Error applying violation\");\r\n    \r\n    if (typeof message === \"string\" && \"validator\" in object) {\r\n      object.validator.isValid(false);\r\n      object.validator.message(message);\r\n    }else{\r\n      throw new Error(\"Error applying violation\\n\"+fieldPath+\" is not validatable\\nit should be an observable\");\r\n    }\r\n  };\r\n\r\n  function applyViolationMessageToValidatable(validatable, message) {\r\n    validatable.validator.isValid(false);\r\n    var oldMessage = validatable.validator.message();\r\n    var newMessage = oldMessage.length == 0 ? message : oldMessage + \", \" + message;\r\n    validatable.validator.message(newMessage);\r\n  };\r\n  \r\n  function applyValidatorTo(property, key, path, executableName){\r\n    if('validator' in property && property.validator instanceof Validator){\r\n      throw new Error(\"Observable `\"+path+\"` is parameter `\"+property.validator.path+\"` in \"+property.validator.executableName+\" and therefore cannot be a parameter in \"+executableName+\"!\");\r\n    }\r\n\r\n    property.validator = new Validator(property, {\r\n      name: key,\r\n      path: path.join(\".\"),\r\n      executableName: executableName\r\n    });\r\n\r\n    property.subscribe(function (newValue) {\r\n      property.validator.validate(newValue);\r\n    });\r\n    \r\n    return property;\r\n  }\r\n  \r\n  return Validatable;\r\n});\n",
    "define('deco/qvc/Executable',[\r\n  \"deco/qvc/ExecutableResult\", \r\n  \"deco/qvc/Validatable\", \r\n  \"deco/utils\", \r\n  \"knockout\"\r\n], function(\r\n  ExecutableResult, \r\n  Validatable, \r\n  utils, \r\n  ko){\r\n\r\n  function Executable(name, type, parameters, hooks, qvc){    \r\n    Validatable.call(this, name, parameters, qvc.constraintResolver)\r\n    \r\n    this.name = name;\r\n    this.type = type;\r\n    this.qvc = qvc;\r\n    this.isBusy = ko.observable(false);\r\n    this.hasError = ko.observable(false);\r\n    this.result = new ExecutableResult();\r\n    \r\n    this.parameters = Object.seal(parameters);\r\n    this.hooks = utils.extend({\r\n      beforeExecute: function () {},\r\n      canExecute: function(){return true;},\r\n      error: function () {},\r\n      success: function () {},\r\n      result: function(){},\r\n      complete: function () {},\r\n      invalid: function() {}\r\n    }, hooks);\r\n  }\r\n    \r\n  Executable.prototype = utils.inheritsFrom(Validatable);\r\n    \r\n  Executable.prototype.execute = function () {\r\n    if (this.isBusy()) {\r\n      return false;\r\n    }\r\n\r\n    this.hasError(false);\r\n\r\n    this.hooks.beforeExecute();\r\n\r\n    this.validate();\r\n    if (!this.isValid()) {\r\n      this.hooks.invalid();\r\n      return false;\r\n    }\r\n\r\n    if (this.hooks.canExecute() === false) {\r\n      return false;\r\n    }\r\n    this.isBusy(true);\r\n\r\n    this.qvc.execute(this);\r\n    return false;\r\n  };\r\n\r\n  Executable.prototype.onError = function () {\r\n    if(\"violations\" in this.result && this.result.violations != null && this.result.violations.length > 0){\r\n      this.applyViolations(this.result.violations);\r\n      this.hooks.invalid();\r\n    }else{\r\n      this.hasError(true);\r\n      this.hooks.error(this.result);\r\n    }\r\n  };\r\n\r\n  Executable.prototype.onSuccess = function () {\r\n    this.hasError(false);\r\n    this.clearValidationMessages();\r\n    this.hooks.success(this.result);\r\n    this.hooks.result(this.result.result);\r\n  };\r\n\r\n  Executable.prototype.onComplete = function () {\r\n    this.hooks.complete();\r\n    this.isBusy(false);\r\n  };\r\n  \r\n  Executable.Command = \"command\";\r\n  Executable.Query = \"query\";\r\n  \r\n  return Executable;\r\n});\n",
    "define('deco/ajax',[], function(){\r\n  function dataToParams(data){\r\n    var params = []\r\n    for(var key in data){\r\n      var value = data[key];\r\n      params.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(value));\r\n    }\r\n    return params.join(\"&\");\r\n  }\r\n\r\n  function addParamToUrl(url, name, value){\r\n    return url + (url.match(/\\?/) ? (url.match(/&$/) ? \"\" : \"&\") : \"?\") + encodeURIComponent(name) + \"=\" + encodeURIComponent(value);\r\n  }\r\n\r\n  function addParamsToUrl(url, data){\r\n    var params = dataToParams(data);\r\n    return url + (url.match(/\\?/) ? (url.match(/&$/) ? \"\" : (params.length > 0 ? \"&\" : \"\")) : \"?\") + params;\r\n  }\r\n\r\n  function addToPath(url, segment){\r\n    return url + (url.match(/\\/$/) ? \"\" : \"/\") + segment;\r\n  }\r\n\r\n  function cacheBust(url){\r\n    return addParamToUrl(url, \"cacheKey\", Math.floor(Math.random()*Math.pow(2,53)));\r\n  }\r\n\r\n  function ajax(url, object, method, callback){\r\n    var xhr = new XMLHttpRequest();\r\n    \r\n    var isPost = (method === \"POST\");\r\n    var data = null;\r\n    \r\n    if(object){\r\n\r\n      if(isPost){\r\n        data = dataToParams(object);\r\n      } else {\r\n        url = addParamsToUrl(url, object);\r\n      }\r\n    }\r\n    \r\n    if(isPost){\r\n      url = cacheBust(url);\r\n    }\r\n\r\n    xhr.open(method, url, true);\r\n    \r\n    if(isPost && data){\r\n      xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n    }\r\n    \r\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n    \r\n    xhr.onreadystatechange = function(){\r\n      if(xhr.readyState == 4){\r\n        callback(xhr);\r\n      }\r\n    }\r\n    \r\n    xhr.send(data);\r\n    return xhr;\r\n  }\r\n\r\n  ajax.addParamToUrl = addParamToUrl;\r\n  ajax.addParamsToUrl = addParamsToUrl;\r\n  ajax.addToPath = addToPath;\r\n  ajax.cacheBust = cacheBust;\r\n\r\n\r\n  return ajax;\r\n});\n",
    "define('deco/qvc/ConstraintResolver',[], function(){\r\n\r\n  var STATE_LOADING = 'loading';\r\n  var STATE_LOADED = 'loaded';\r\n\r\n  function findConstraint(name, constraints) {\r\n    for (var i = 0; i < constraints.length; i++) {\r\n      if (constraints[i].name == name) {\r\n        return constraints[i];\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function constraintsLoaded(name, fields){\r\n    var constraint = findConstraint(name, this.constraints);\r\n    if(constraint){\r\n      constraint.validatables.forEach(function(validatable){\r\n        validatable.applyConstraints(fields);\r\n      });\r\n      constraint.fields = fields;\r\n      constraint.state = STATE_LOADED;\r\n      constraint.validatables = [];\r\n    }\r\n  }\r\n\r\n\r\n  function ConstraintResolver(qvc){\r\n    this.qvc = qvc;\r\n    this.constraints = [];\r\n  }\r\n  \r\n  ConstraintResolver.prototype.applyValidationConstraints = function(name, validatable){\r\n    var constraint = findConstraint(name, this.constraints);\r\n    if(constraint === false){\r\n      this.constraints.push({\r\n        name: name,\r\n        state: STATE_LOADING,\r\n        validatables: [validatable]\r\n      });\r\n      this.qvc.loadConstraints(name, constraintsLoaded.bind(this));\r\n    }else{\r\n      if(constraint.state === STATE_LOADING){\r\n        constraint.validatables.push(validatable);\r\n      }else{\r\n        validatable.applyConstraints(constraint.fields);\r\n      }\r\n    }\r\n  };\r\n  \r\n  return ConstraintResolver;\r\n});\n",
    "define('deco/errorHandler',[], function(){\r\n  return {\r\n    onError: function(error){\r\n      setTimeout(function(){\r\n        throw error;\r\n      },1);\r\n    }\r\n  };\r\n});\n",
    "define('deco/qvc',[\r\n  \"deco/qvc/Executable\", \r\n  \"deco/qvc/ExecutableResult\", \r\n  \"deco/utils\", \r\n  \"deco/ajax\",\r\n  \"deco/qvc/ConstraintResolver\",\r\n  \"deco/errorHandler\",\r\n  \"knockout\", \r\n  \"deco/qvc/koExtensions\"], \r\n  function(\r\n    Executable,\r\n    ExecutableResult,\r\n    utils,\r\n    ajax,\r\n    ConstraintResolver,\r\n    errorHandler,\r\n    ko){\r\n  \r\n  function QVC(){\r\n\r\n    var qvc = this;\r\n\r\n    this.constraintResolver = new ConstraintResolver(qvc);\r\n\r\n    this.execute = function(executable){\r\n      var parameters = ko.toJS(executable.parameters);\r\n      var data = {\r\n        parameters: JSON.stringify(parameters),\r\n        csrfToken: qvc.config.csrf\r\n      };\r\n      var url = ajax.addToPath(qvc.config.baseUrl, executable.type + \"/\" + executable.name);\r\n      ajax(url, data, \"POST\", function (xhr) {\r\n        if (xhr.status === 200) {\r\n          executable.result = new ExecutableResult(JSON.parse(xhr.responseText || \"{}\"));\r\n          if (executable.result.success === true) {\r\n            executable.onSuccess();\r\n          } else {\r\n            if(executable.result.exception && executable.result.exception.message){\r\n              errorHandler.onError(executable.result.exception.message);\r\n            }\r\n            executable.onError();\r\n          }\r\n        } else {\r\n          executable.result = new ExecutableResult({exception: {message: xhr.responseText, cause: xhr}});\r\n          errorHandler.onError(executable.result.exception.message);\r\n          executable.onError();\r\n        }\r\n        executable.onComplete();\r\n      });\r\n    \r\n    };\r\n    \r\n    this.loadConstraints = function(name, callback){\r\n      var url = ajax.addToPath(qvc.config.baseUrl, \"constraints/\" + name);\r\n      ajax(url, null, \"GET\", function(xhr){\r\n        if (xhr.status === 200) {\r\n          try{\r\n            var response = JSON.parse(xhr.responseText || \"{\\\"parameters\\\":[]}\");\r\n            if(\"parameters\" in response == false){\r\n              response.parameters = [];\r\n            }\r\n            if(response.exception && response.exception.message){\r\n              errorHandler.onError(response.exception.message);\r\n            }\r\n          }catch(e){\r\n            var response = {parameters: []};\r\n          }\r\n          callback(name, response.parameters);\r\n        }else{\r\n          errorHandler.onError(xhr.responseText);\r\n        }\r\n      });\r\n    };\r\n\r\n    \r\n    this.config = {\r\n      baseUrl: \"/\",\r\n      csrf: \"\"\r\n    }\r\n  };\r\n\r\n  var qvc = new QVC();\r\n  \r\n  function createExecutable(name, type, parameters, callbacks){  \r\n    var executable = new Executable(name, type, parameters || {}, callbacks || {}, qvc);\r\n    var execute = executable.execute.bind(executable);\r\n    execute.isValid = ko.computed(executable.isValid, executable);\r\n    execute.isBusy = ko.computed(executable.isBusy, executable);\r\n    execute.hasError = ko.computed(executable.hasError, executable);\r\n    execute.success = function(callback){\r\n      executable.hooks.success = callback;\r\n      return execute;\r\n    };\r\n    execute.error = function(callback){\r\n      executable.hooks.error = callback;\r\n      return execute;\r\n    };\r\n    execute.invalid = function(callback){\r\n      executable.hooks.invalid = callback;\r\n      return execute;\r\n    };\r\n    execute.beforeExecute = function(callback){\r\n      executable.hooks.beforeExecute = callback;\r\n      return execute;\r\n    };\r\n    execute.canExecute = function(callback){\r\n      executable.hooks.canExecute = callback;\r\n      return execute;\r\n    };\r\n    execute.result = function(){\r\n      if(arguments.length == 1){\r\n        executable.hooks.result = arguments[0];\r\n        return execute;\r\n      }\r\n      return executable.result.result;\r\n    };\r\n    execute.complete = function(callback){\r\n      executable.hooks.complete = callback;\r\n      return execute;\r\n    };\r\n    execute.clearValidationMessages = executable.clearValidationMessages.bind(executable);\r\n    execute.validator = executable.validator;\r\n    execute.parameters = executable.parameters;\r\n    execute.validate = executable.validate.bind(executable);\r\n    \r\n    return execute;\r\n  }\r\n  \r\n  return {\r\n    createCommand: function(name, parameters, hooks){\r\n      if(name == null || name.length == 0)\r\n        throw new Error(\"Command is missing name\\nA command must have a name!\\nusage: createCommand('name', [parameters, hooks])\");\r\n      return createExecutable(name, Executable.Command, parameters, hooks);\r\n    },\r\n    createQuery: function(name, parameters, hooks){\r\n      if(name == null || name.length == 0)\r\n        throw new Error(\"Query is missing name\\nA query must have a name!\\nusage: createQuery('name', [parameters, hooks])\");\r\n      return createExecutable(name, Executable.Query, parameters, hooks);\r\n    },\r\n    config: function(config){\r\n      utils.extend(qvc.config, config);\r\n    }\r\n  }\r\n});\n",
    "define('deco/spa/Outlet',[\r\n  \"knockout\"\r\n], function(\r\n  ko\r\n){\r\n\r\n  function Outlet(element, document){\r\n    this.element = element;\r\n    this.document = document || window.document;\r\n  }\r\n\r\n  Outlet.prototype.outletExists = function(){\r\n    return this.element != null;\r\n  };\r\n\r\n  Outlet.prototype.unloadCurrentPage = function(){\r\n    ko.cleanNode(this.element);\r\n    this.element.innerHTML = \"\";\r\n  };\r\n\r\n  Outlet.prototype.setPageContent = function(content){\r\n    this.element.innerHTML = content;\r\n  };\r\n\r\n  Outlet.prototype.getPageTitle = function(){\r\n    var titleMetaTag = this.element.querySelector(\"meta[name=title]\");\r\n    return (titleMetaTag && titleMetaTag.getAttribute(\"content\"));\r\n  };\r\n\r\n  Outlet.prototype.setDocumentTitle = function(title){\r\n    this.document.title = title;\r\n  };\r\n\r\n  Outlet.prototype.extractAndRunPageJavaScript = function(){\r\n    var scripts = this.element.querySelectorAll(\"script[type='text/javascript']\");\r\n    for(var i=0; i<scripts.length; i++){\r\n      scripts[i].parentNode.removeChild(scripts[i]);\r\n      if(scripts[i].id === '') throw new Error(\"The script must have an id\");\r\n      if(this.document.getElementById(scripts[i].id) == null){\r\n        var script = this.document.createElement(\"script\");\r\n        script.id = scripts[i].id;\r\n        script.text = scripts[i].textContent;\r\n        script.setAttribute('type', scripts[i].getAttribute('type'));\r\n        this.document.body.appendChild(script);\r\n      }\r\n    }\r\n  };\r\n\r\n  Outlet.prototype.indicatePageIsLoading = function(){\r\n    this.element.setAttribute(\"data-loading\", \"true\");\r\n  };\r\n\r\n  Outlet.prototype.pageHasLoaded = function(){\r\n    this.element.setAttribute(\"data-loading\", \"false\");\r\n  };\r\n\r\n  return Outlet;\r\n\r\n});\n",
    "define('deco/spa/whenContext',[\r\n  \r\n], function(\r\n  \r\n){\r\n\r\n  function unsubscribe(event, reaction){\r\n    event.dont(reaction);\r\n  }\r\n\r\n  function subscribe(event, reaction){\r\n    event(reaction);\r\n    return event.dont.bind(null, reaction);\r\n  }\r\n\r\n  function whenSomething(){\r\n    if(this.destroyed) throw new Error(\"This context has been destroyed!\");\r\n\r\n    if(arguments.length == 0){\r\n      var childContext = createContext();\r\n      this.childContexts.push(childContext);\r\n      return childContext.when;\r\n    }else if(arguments.length == 1 && typeof arguments[0] === \"function\"){\r\n      return {\r\n        dont: unsubscribe.bind(null, arguments[0])\r\n      }\r\n    }else if(arguments.length == 2 && typeof arguments[1] === \"function\"){\r\n      this.eventSubscribers.push(subscribe(arguments[0], arguments[1]));\r\n    }\r\n  }\r\n\r\n  function thisIsDestroyed(reaction){\r\n    this.onDestroyListeners.push(reaction);\r\n  }\r\n\r\n  function destroyChildContexts(){\r\n    var context;\r\n    while(context = this.childContexts.pop())\r\n      context.destroyContext();\r\n  }\r\n\r\n  function destroyContext(){\r\n    var subscriber, listener, context;\r\n    while(subscriber = this.eventSubscribers.pop())\r\n      subscriber();\r\n    while(listener = this.onDestroyListeners.pop())\r\n      listener();\r\n    while(context = this.childContexts.pop())\r\n      context.destroyContext();\r\n    this.destroyed = true;\r\n  }\r\n\r\n  function createContext(){\r\n    var context = {\r\n      destroyed: false,\r\n      onDestroyListeners: [],\r\n      childContexts: [],\r\n      eventSubscribers: []\r\n    };\r\n\r\n    var when = whenSomething.bind(context);\r\n\r\n    when.thisIsDestroyed = thisIsDestroyed.bind(context);\r\n\r\n    when.destroyChildContexts = destroyChildContexts.bind(context);\r\n\r\n    return {\r\n      when: when,\r\n      destroyContext: destroyContext.bind(context)\r\n    };\r\n  }\r\n\r\n  return createContext().when;\r\n});\n",
    "define('deco/spa/viewModelFactory',[\r\n  \"deco/errorHandler\"\r\n], function(\r\n  errorHandler\r\n) {\r\n  return {\r\n    getViewModelFromAttributes: function(target){\r\n      var viewModelName = target.getAttribute(\"data-viewmodel\");\r\n      var model = target.getAttribute(\"data-model\");\r\n\r\n      return {\r\n        target: target,\r\n        viewModelName: viewModelName,\r\n        model: model\r\n      };\r\n    },\r\n    \r\n    getParentViewModelElement: function(element, maxAncestor){\r\n      while(element = element.parentNode){\r\n        if(element === maxAncestor) return null;\r\n        if(element.hasAttribute(\"data-viewmodel\")) return element;\r\n      }\r\n      return null;\r\n    },\r\n    \r\n    loadViewModel: function(data){\r\n      return new Promise(function(resolve, reject){\r\n        require([data.viewModelName], resolve, reject);\r\n      }).then(function(ViewModel){\r\n        return {\r\n          viewModelName: data.viewModelName,\r\n          ViewModel: ViewModel,\r\n          model: data.model,\r\n          target: data.target\r\n        }\r\n      }, function(error){\r\n        errorHandler.onError(new Error(\"Could not load the following modules:\\n\"+error.requireModules.join(\"\\n\")));\r\n        return null;\r\n      });\r\n    },\r\n\r\n    createViewModel: function(data, subscribe, params) {\r\n      var model = (data.model && (data.model.charAt(0) == '{' || data.model.charAt(0) == '['))\r\n        ? JSON.parse(data.model)\r\n        : params;\r\n      var whenContext = subscribe();\r\n      var viewModel = new data.ViewModel(model, whenContext);\r\n      viewModel['@SymbolDecoWhenContext'] = whenContext;\r\n      return {\r\n        viewModelName: data.viewModelName,\r\n        viewModel: viewModel,\r\n        target: data.target\r\n      }\r\n    }\r\n  }\r\n});\n",
    "define('deco/spa/extendKnockout',[\r\n  \"deco/spa/viewModelFactory\",\r\n  \"deco/errorHandler\",\r\n  \"knockout\"\r\n], function(\r\n  viewModelFactory,\r\n  errorHandler,\r\n  ko\r\n){\r\n    \r\n  var nativeBindingProviderInstance = new ko.bindingProvider();\r\n  var originalBindingProvider = ko.bindingProvider.instance;\r\n\r\n  ko.bindingProvider.instance = {\r\n    nodeHasBindings: function(node){\r\n      return hasViewModel(node) || originalBindingProvider.nodeHasBindings(node);\r\n    },\r\n    getBindingAccessors: function(node, context){\r\n      if(hasViewModel(node)){\r\n        return {\r\n          '@SymbolDecoApplyViewModel': function(){ return null; }\r\n        };\r\n       }else{\r\n         return originalBindingProvider.getBindingAccessors(node, context);\r\n       }\r\n    }\r\n  };\r\n\r\n\r\n  ko.bindingHandlers['@SymbolDecoApplyViewModel'] = {\r\n    init: function(element, valueAccessor, allBindingsAccessor, deprecated, parentContext){\r\n      var parentViewModel = viewModelFactory.getParentViewModelElement(element)['@SymbolDecoViewModel'];\r\n      var whenContext = parentViewModel['@SymbolDecoWhenContext']();\r\n      try{\r\n      var params = getComponentParamsFromCustomElement(element, parentContext);\r\n      }catch(e){\r\n        console.error(e.stack);\r\n      }\r\n      Promise.resolve(viewModelFactory.getViewModelFromAttributes(element))\r\n      .then(function(data){\r\n        return viewModelFactory.loadViewModel(data)\r\n      }).then(function(data){\r\n        return viewModelFactory.createViewModel(data, whenContext, params);\r\n      }).then(function(data){\r\n        data.target['@SymbolDecoViewModel'] = data.viewModel;\r\n        \r\n        var childContext = parentContext.createChildContext(data.viewModel);\r\n        ko.utils.domData.clear(data.target);\r\n        ko.applyBindings(childContext, data.target);\r\n        \r\n        ko.utils.domNodeDisposal.addDisposeCallback(data.target, function() {\r\n          delete data.target['@SymbolDecoViewModel'];\r\n          whenContext.destroyChildContexts();\r\n        });\r\n      })['catch'](errorHandler.onError);\r\n\r\n      return {\r\n        controlsDescendantBindings: true\r\n      };\r\n    }\r\n  };\r\n  \r\n  //this is stolen from the knockout sourcecode, and I had to copy it since it's not exposed as a public api\r\n\r\n  function getComponentParamsFromCustomElement(elem, bindingContext) {\r\n    var paramsAttribute = elem.getAttribute('data-params');\r\n\r\n    if (!paramsAttribute) {\r\n      return undefined;\r\n    }\r\n    \r\n    var params = nativeBindingProviderInstance['parseBindingsString'](paramsAttribute, bindingContext, elem, { 'valueAccessors': true, 'bindingParams': true });\r\n    var rawParamComputedValues = Object.create(null);\r\n    for(paramName in params) {\r\n      var paramValue = params[paramName];\r\n      rawParamComputedValues[paramName] = ko.computed(paramValue, null, { disposeWhenNodeIsRemoved: elem });\r\n    }\r\n    var result = Object.create(null);\r\n    for(paramName in rawParamComputedValues) {\r\n      var paramValueComputed = rawParamComputedValues[paramName];\r\n      var paramValue = paramValueComputed.peek();\r\n      // Does the evaluation of the parameter value unwrap any observables?\r\n      if (!paramValueComputed.isActive()) {\r\n        // No it doesn't, so there's no need for any computed wrapper. Just pass through the supplied value directly.\r\n        // Example: \"someVal: firstName, age: 123\" (whether or not firstName is an observable/computed)\r\n        result[paramName] = paramValue;\r\n      } else {\r\n        // Yes it does. Supply a computed property that unwraps both the outer (binding expression)\r\n        // level of observability, and any inner (resulting model value) level of observability.\r\n        // This means the component doesn't have to worry about multiple unwrapping. If the value is a\r\n        // writable observable, the computed will also be writable and pass the value on to the observable.\r\n        result[paramName] = ko.computed({\r\n          'read': function() {\r\n            return ko.unwrap(paramValueComputed());\r\n          },\r\n          'write': ko.isWriteableObservable(paramValue) && function(value) {\r\n            paramValueComputed()(value);\r\n          },\r\n          disposeWhenNodeIsRemoved: elem\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  \r\n  function hasViewModel(node){\r\n    return node.nodeType === 1 && node.hasAttribute(\"data-viewmodel\") && !('@SymbolDecoViewModel' in node);\r\n  }\r\n});\n",
    "define('deco/spa/applyViewModels',[\r\n  \"deco/utils\",\r\n  \"deco/errorHandler\",\r\n  \"deco/spa/viewModelFactory\",\r\n  \"knockout\",\r\n  \"deco/spa/extendKnockout\"\r\n], function (\r\n  utils, \r\n  errorHandler,\r\n  viewModelFactory,\r\n  ko\r\n) {\r\n\r\n  function applyViewModel(data) {\r\n    data.target['@SymbolDecoViewModel'] = data.viewModel;\r\n    ko.applyBindings(data.viewModel, data.target);\r\n  }\r\n\r\n  function viewModelLoadedSuccessfully(data){\r\n    return data != null && data.ViewModel != null;\r\n  }\r\n\r\n  return function (domElement, subscribe) {\r\n    domElement = domElement || document.body;\r\n\r\n    var viewModelsLoaded = utils.toArray(domElement.querySelectorAll(\"[data-viewmodel]\"))\r\n    .filter(function(element){\r\n      return viewModelFactory.getParentViewModelElement(element, domElement) ? false : true;\r\n    })\r\n    .map(viewModelFactory.getViewModelFromAttributes)\r\n    .map(viewModelFactory.loadViewModel);\r\n\r\n    return Promise.all(viewModelsLoaded).then(function(list){\r\n      list\r\n        .filter(viewModelLoadedSuccessfully)\r\n        .map(function(data){\r\n          return viewModelFactory.createViewModel(data, subscribe);\r\n        })\r\n        .forEach(applyViewModel);\r\n    })['catch'](errorHandler.onError);\r\n  };\r\n});\n",
    "define('deco/spa/hashNavigation',[\r\n  \"deco/utils\"\r\n],function(\r\n  _\r\n){\r\n\r\n\r\n  \r\n  function findNewPath(currentPath, link, index){\r\n    var isRelative = _.startsWith(link, '/') === false;\r\n    var isFolder = _.endsWith(link, '/');\r\n    \r\n    if(link === \"/\"){\r\n      var path = [];\r\n    }else if(link === \"\"){\r\n      var path = [index];\r\n    }else{\r\n      var path = _.trim(link, \"/\").split(\"/\");\r\n    }\r\n\r\n    if(isFolder){\r\n      path.push(index);\r\n    }\r\n    if(isRelative){\r\n      path = _.popTail(currentPath).concat(path);\r\n    }\r\n\r\n    var out = [];\r\n    var isPretty = true;\r\n    var segmentsToSkip = 0;\r\n\r\n    for(var i = path.length-1; i>=0; i--){\r\n      if(path[i] === \"\"){\r\n        isPretty = false;\r\n      }else if(path[i] === \".\"){\r\n        isPretty = false;\r\n      }else if(path[i] === \"..\") {\r\n        isPretty = false;\r\n        segmentsToSkip++;\r\n      }else if(segmentsToSkip > 0){\r\n        segmentsToSkip--;\r\n      }else{\r\n        out.unshift(path[i]);\r\n      }\r\n    }\r\n\r\n    return {isAbsoluteAndPretty: !isFolder && !isRelative && isPretty, path: out};\r\n  }\r\n\r\n  function hashChanged(config, onPageChanged, document){\r\n    var link = _.after(document.location.href, '#');\r\n    var isHashBang = _.startsWith(link, '!');\r\n    var result = findNewPath(this.currentPath, link.substr(isHashBang ? 1 : 0), config.index);\r\n    \r\n    if(result.isAbsoluteAndPretty && isHashBang){\r\n      this.currentPath = result.path;\r\n      onPageChanged(result.path.join('/'), result.path.map(decodeURIComponent));\r\n    }else{\r\n      document.location.replace(\"#!/\" + result.path.join('/'));\r\n    }\r\n\r\n  }\r\n  \r\n  function startHashNavigation(config, onPageChanged, doc, global){\r\n    doc = doc || document;\r\n    global = global || window;\r\n\r\n    var state = {\r\n      currentPath: []\r\n    };\r\n    var onHashChanged = hashChanged.bind(state, config, onPageChanged, doc);\r\n    onHashChanged();\r\n    _.addEventListener(global, \"hashchange\", onHashChanged, false);\r\n\r\n    return {\r\n      stop: function(){\r\n        global.removeEventListener(\"hashchange\", onHashChanged, false);\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  return {\r\n    start: startHashNavigation\r\n  };\r\n\r\n});\n",
    "define('deco/spa/PageLoader',[\r\n  \"deco/ajax\"\r\n], function(\r\n  ajax\r\n){\r\n\r\n  function PageLoader(config){\r\n    this.pathToUrl = config && config.pathToUrl || function(a){ return a; };\r\n    this.cache = (config && 'cachePages' in config ? config.cachePages : true);\r\n    this.currentXHR = null;\r\n  }\r\n\r\n  PageLoader.prototype.loadPage = function(path){\r\n\r\n    this.abort();\r\n\r\n    var url = this.pathToUrl(path);\r\n\r\n    if(this.cache === false)\r\n      url = ajax.cacheBust(url);\r\n    \r\n    var self = this;\r\n    return new Promise(function(resolve, reject){\r\n      self.currentXHR = ajax(url, {}, \"GET\", function(xhr){\r\n        self.currentXHR = null;\r\n        if(xhr.status === 200){\r\n          resolve(xhr.responseText);\r\n        }else{\r\n          reject({error: xhr.status, content: xhr.responseText});\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  PageLoader.prototype.abort = function(){\r\n    if(this.currentXHR && this.currentXHR.readyState !== 4){\r\n      this.currentXHR.abort();\r\n    }\r\n  };\r\n\r\n  return PageLoader;\r\n});\n",
    "define('deco/spa/Templates',[\r\n  \"deco/spa/PageLoader\",\r\n  \"deco/utils\"\r\n], function(\r\n  PageLoader,\r\n  utils\r\n){\r\n\r\n  function defaultConfig(){\r\n    return {\r\n      pathToUrl: function(a){ return a; }\r\n    }\r\n  }\r\n\r\n  function findTemplatesInDocument(doc){\r\n\r\n    var nodeList = doc.querySelectorAll(\"[type='text/page-template']\");\r\n    var nodes = utils.toArray(nodeList);\r\n    var templateList = nodes.map(function(template){\r\n      return {\r\n        id: template.id.toLowerCase(),\r\n        content: template.innerHTML\r\n      };\r\n    });\r\n\r\n    return utils.arrayToObject(templateList, function(item, object){\r\n      object[item.id] = item.content;\r\n    });\r\n  }\r\n\r\n\r\n  function Templates(document, config){\r\n    this.pageLoader = new PageLoader(config || defaultConfig());\r\n    this.cachePages = (config && 'cachePages' in config ? config.cachePages : true)\r\n    this.templates = findTemplatesInDocument(document);\r\n  }\r\n\r\n  Templates.prototype.getTemplate = function(path){\r\n\r\n    this.pageLoader.abort();\r\n\r\n    var normalizedPath = path.toLowerCase();\r\n\r\n    if(normalizedPath in this.templates){\r\n      return Promise.resolve(this.templates[normalizedPath]);\r\n    }else{\r\n      return this.pageLoader.loadPage(path)\r\n      .then(function(content){\r\n        if(this.cachePages)\r\n          this.templates[normalizedPath] = content;\r\n        \r\n        return content;\r\n      }.bind(this), function(notFound){\r\n        var errorTemplate = \"error\" + notFound.error;\r\n        if(errorTemplate in this.templates){\r\n          return this.templates[errorTemplate];\r\n        }else{\r\n          return notFound.content;\r\n        }\r\n      }.bind(this));\r\n    }\r\n  };\r\n\r\n  return Templates;\r\n});\n",
    "define('deco/proclaimWhen',[], function () {\r\n\r\n  function publish(name, subscribers, data) {\r\n    subscribers.forEach(function (item) {\r\n      item.apply(item, data);\r\n    });\r\n  }\r\n\r\n  function subscribeTo(name, subscribers, subscriber) {\r\n    var index = subscribers.indexOf(subscriber);\r\n    if(index < 0)\r\n      subscribers.push(subscriber);\r\n    return index < 0;\r\n  }\r\n  \r\n  function unsubscribeFrom(name, subscribers, subscriber){\r\n    var index = subscribers.indexOf(subscriber);\r\n    if(index >= 0)\r\n      subscribers.splice(index, 1);\r\n    return index >= 0;\r\n  }\r\n  function extendEvent(name, event){\r\n    event.subscribers = [];\r\n    event.subscribeSubscribers = [];\r\n    event.unsubscribeSubscribers = [];\r\n\r\n    var extendedEvent = function(){\r\n      if(arguments.length == 1 && typeof arguments[0] === \"function\"){\r\n        if(subscribeTo(name, event.subscribers, arguments[0]))\r\n          publish(name+\".isSubscribedTo\", event.subscribeSubscribers);\r\n      }else{\r\n        publish(name, event.subscribers, arguments);\r\n      }\r\n    }\r\n\r\n    extendedEvent.dont = function(subscriber){\r\n      if(unsubscribeFrom(name, event.subscribers, subscriber))\r\n        publish(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers);\r\n    };\r\n\r\n    extendedEvent.isSubscribedTo = function(subscriber){\r\n      subscribeTo(name+\".isSubscribedTo\", event.subscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isSubscribedTo.dont = function(subscriber){\r\n      unsubscribeFrom(name+\".isSubscribedTo\", event.subscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isUnsubscribedFrom = function(subscriber){\r\n      subscribeTo(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.isUnsubscribedFrom.dont = function(subscriber){\r\n      unsubscribeFrom(name+\".isUnsubscribedFrom\", event.unsubscribeSubscribers, subscriber);\r\n    };\r\n\r\n    extendedEvent.toString = function(){\r\n      return \"[Event \"+name+\"]\";\r\n    }\r\n\r\n    return extendedEvent;\r\n  }\r\n  \r\n  function extend(events){\r\n    for(var i in events){\r\n      events[i] = extendEvent(i, events[i]);\r\n    }\r\n    return events;\r\n  }\r\n\r\n  function create(arg1, arg2){\r\n    if(arg2)\r\n      return extendEvent(arg1, arg2);\r\n    else\r\n      return extendEvent(\"anonymous event\", arg1)\r\n  }\r\n\r\n  return {\r\n    extend: extend,\r\n    create: create\r\n  };\r\n  \r\n});\r\n\n",
    "define('deco/events',['deco/proclaimWhen'], function(proclaimWhen){\r\n  return proclaimWhen.extend({\r\n    thePageHasChanged: function(path, segments, url){ }\r\n  });\r\n});\n",
    "define('deco/spa',[\r\n  \"deco/spa/Outlet\",\r\n  \"deco/spa/whenContext\",\r\n  \"deco/spa/applyViewModels\",\r\n  \"deco/spa/hashNavigation\",\r\n  \"deco/spa/Templates\",\r\n  \"deco/utils\",\r\n  \"deco/events\",\r\n  \"deco/errorHandler\"\r\n], function(\r\n  Outlet,\r\n  whenContext,\r\n  applyViewModels,\r\n  hashNavigation,\r\n  Templates,\r\n  utils,\r\n  proclaim,\r\n  errorHandler\r\n){\r\n\r\n  var _config = {\r\n      index: \"index\"\r\n    },\r\n    _document,\r\n    _outlet,\r\n    _originalTitle,\r\n    _templates,\r\n    _whenContext;\r\n\r\n  function applyContent(content){\r\n    _outlet.unloadCurrentPage();\r\n    _outlet.setPageContent(content);\r\n    _outlet.setDocumentTitle(_outlet.getPageTitle() || _originalTitle);\r\n    _outlet.extractAndRunPageJavaScript();\r\n    return applyViewModels(_outlet.element, _whenContext());\r\n  }\r\n\r\n  function pageChanged(path, segments){\r\n    _outlet.indicatePageIsLoading();\r\n    _whenContext.destroyChildContexts();\r\n    return _templates.getTemplate(path)\r\n      .then(applyContent)\r\n      .then(function(){\r\n        _outlet.pageHasLoaded();\r\n        proclaim.thePageHasChanged(path, segments, document.location)\r\n      })['catch'](errorHandler.onError);;\r\n  }\r\n\r\n  function start(config, document){\r\n    _document = document || window.document;\r\n    _config = utils.extend(_config, config);\r\n    _outlet = new Outlet(_document.querySelector(\"[data-outlet]\"), _document);\r\n    _originalTitle = _document.title;\r\n    _whenContext = whenContext();\r\n\r\n    return applyViewModels(_document, whenContext()).then(function(){\r\n      if(_outlet.outletExists()){\r\n        _templates = new Templates(_document, _config);\r\n        hashNavigation.start(_config, pageChanged, _document);\r\n      }\r\n    });\r\n  }\r\n\r\n  return {\r\n    start: start\r\n  };\r\n});\n",
    "define('deco/deco',[\r\n  'deco/qvc',\r\n  'deco/spa'\r\n], function(\r\n  qvc,\r\n  spa\r\n){\r\n\r\n  \r\n\r\n  function config(config){\r\n\r\n    config = config || {};\r\n\r\n    var spaConfig = config.spa || {};\r\n    var qvcConfig = config.qvc || {};\r\n\r\n    qvc.config(qvcConfig);\r\n\r\n    return {\r\n      start: spa.start.bind(null, spaConfig, document)\r\n    }\r\n  }\r\n  \r\n  return {\r\n    config: config\r\n  };\r\n\r\n});\ndefine('deco', ['deco/deco'], function (main) { return main; });\n\n",
    "define('deco/qvc/constraints/NotEmpty',[], function(){\r\n  function NotEmpty(attributes){\r\n    \r\n  }\r\n  \r\n  NotEmpty.prototype.isValid = function(value){\r\n    if(value == null) return false;\r\n    if(typeof value == \"string\" && value.length == 0) return false;\r\n    return true;\r\n  };\r\n  \r\n  return NotEmpty;\r\n});\n",
    "define('deco/qvc/constraints/Pattern',[], function(){\r\n  function Pattern(attributes){    \r\n\r\n    attributes.flags = attributes.flags || [];\r\n    \r\n    var flags = '';\r\n    if(attributes.flags.indexOf(\"CASE_INSENSITIVE\") >= 0) flags += 'i';\r\n    \r\n    this.regex = new RegExp(attributes.regexp, flags);\r\n  }\r\n  \r\n  \r\n  Pattern.prototype.isValid = function(value){\r\n    \r\n    if(value == null) return false;\r\n    \r\n    var result = this.regex.exec(value);\r\n    \r\n    if(result == null) return false;\r\n    \r\n    return result[0] == value;\r\n  };\r\n  \r\n  \r\n  return Pattern;\r\n});\n"
  ]
}