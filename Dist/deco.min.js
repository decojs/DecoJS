define("deco/utils",[],function(){return{toArray:function(a){for(var b=[],c=a.length>>>0;c--;)b[c]=a[c];return b},extend:function(a,b){b=b||{},a=a||{};for(var c in b)a[c]=b[c];return a},arrayToObject:function(a,b){return a.reduce(function(a,c){return b(c,a),a},{})},trim:function(a,b){for(;a.charAt(0)==b;)a=a.substr(1);for(;a.charAt(a.length-1)==b;)a=a.substr(0,a.length-1);return a},after:function(a,b){var c=a.indexOf(b);return 0>c?"":a.substr(c+1)},popTail:function(a){return a.slice(0,-1)},startsWith:function(a,b){return a.charAt(0)===b},endsWith:function(a,b){return a.charAt(a.length-1)===b},addEventListener:function(a,b,c,d){"addEventListener"in a?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}}}),define("deco/qvc/ExecutableResult",["deco/utils"],function(a){function b(b){this.success=!1,this.valid=!1,this.result=null,this.exception=null,this.violations=[],a.extend(this,b)}return b}),define("deco/qvc/Constraint",[],function(){function a(a,b){this.type=a,this.attributes=b,this.message=b.message,this.init(a)}return a.prototype.init=function(a){require(["deco/qvc/constraints/"+a],function(a){var b=new a(this.attributes);this.validate=b.isValid.bind(b)}.bind(this))},a.prototype.validate=function(){return!0},a}),define("deco/qvc/Validator",["deco/qvc/Constraint","knockout"],function(a,b){function c(a,b,c,d,e){return a.replace(/\{([^}]+)\}/g,function(a,f){return"value"==f?c:"this.name"==f?d:"this.path"==f?e:f in b?b[f]:a})}function d(a,c){this.constraints=[],this.isValid=b.observable(!0),this.message=b.observable(""),this.name=c&&c.name,this.path=c&&c.path}return d.prototype.setConstraints=function(b){this.constraints=b.map(function(b){return new a(b.name,b.attributes)})},d.prototype.reset=function(){this.isValid(!0),this.message("")},d.prototype.validate=function(a){0==this.constraints.length?this.reset():this.constraints.every(function(b){return b.validate(a)?!0:(this.isValid(!1),this.message(c(b.message,b.attributes,a,this.name,this.path)),!1)}.bind(this))&&(this.isValid(!0),this.message(""))},d}),define("deco/qvc/koExtensions",["deco/qvc/Validator","knockout"],function(a,b){null!=b&&(b.bindingHandlers.validationMessageFor={init:function(a,c){var d=c(),e=d.validator;if(!e){var f=Array.prototype.reduce.call(a.attributes,function(a,b){return a+" "+b.localName+'="'+b.value+'"'},"");throw new Error("Could not bind `validationMessageFor` to value on element <"+a.tagName.toLowerCase()+f+">")}b.applyBindingsToNode(a,{hidden:e.isValid,text:e.message},e)}},b.extenders.validation=function(b,c){return b.validator=new a(b,c),b.subscribe(function(a){b.validator.validate(a)}),b},b.bindingHandlers.command=b.bindingHandlers.query={init:function(a,c,d,e){b.applyBindingsToNode(a,{click:c()},e)}})}),define("deco/qvc/Validatable",["deco/utils","deco/qvc/Validator","knockout","deco/qvc/koExtensions"],function(a,b,c){function d(a,b,e){for(var f in a){var g=a[f],h=e.concat([f]);c.isObservable(g)&&(g.extend({validation:{name:f,path:h.join(".")}}),b.push(g)),g=c.utils.unwrapObservable(g),"object"==typeof g&&d(g,b,h)}}function e(a,b,d){return a.split(".").reduce(function(b,e){var f=b.path,g=c.utils.unwrapObservable(b.field);if(e in g)return{field:g[e],path:f+"."+e};throw new Error(d+": "+a+"\n"+e+" is not a member of "+f+"\n"+f+" = `"+c.toJSON(g)+"`")},{field:b,path:"parameters"}).field}function f(a,b,c){var d=e(b,a,"Error applying violation");if(!("string"==typeof c&&"validator"in d))throw new Error("Error applying violation\n"+b+" is not validatable\nit should be an observable");d.validator.isValid(!1),d.validator.message(c)}function g(a,b){a.validator.isValid(!1);var c=a.validator.message(),d=0==c.length?b:c+", "+b;a.validator.message(d)}function h(a,c,e){var f=this;this.validator=new b,this.validatableFields=[],this.validatableParameters=c,d(f.validatableParameters,f.validatableFields,[]),e&&e.applyValidationConstraints(a,f)}return h.prototype.isValid=function(){return this.validatableFields.every(function(a){return a.validator&&a.validator.isValid()})&&this.validator.isValid()},h.prototype.applyViolations=function(a){a.forEach(function(a){var b=a.message,c=a.fieldName;c.length>0?f(this.validatableParameters,c,b):g(this,b)}.bind(this))},h.prototype.applyConstraints=function(a){var b=this.validatableParameters;a.forEach(function(a){var d=a.name,f=a.constraints;if(null!=f&&0!=f.length){var g=e(d,b,"Error applying constraints to field");if(!(c.isObservable(g)&&"validator"in g))throw new Error("Error applying constraints to field: "+d+"\nIt is not an observable or is not extended with a validator. \n"+d+"=`"+c.toJSON(g)+"`");g.validator.setConstraints(f)}})},h.prototype.validate=function(){this.validator.validate(!0),this.validator.isValid()&&this.validatableFields.forEach(function(a){var b=a.validator;b&&b.validate(a())})},h.prototype.clearValidationMessages=function(){this.validator.reset(),this.validatableFields.forEach(function(a){var b=a.validator;b&&b.reset()})},h}),define("deco/qvc/Executable",["deco/qvc/ExecutableResult","deco/qvc/Validatable","deco/utils","knockout"],function(a,b,c,d){function e(e,f,g,h,i){var j=this;this.name,this.type,this.isBusy=d.observable(!1),this.hasError=d.observable(!1),this.result=new a,this.parameters={},this.callbacks={beforeExecute:function(){},canExecute:function(){return!0},error:function(){},success:function(){},result:function(){},complete:function(){}},this.execute=function(){j.onBeforeExecute()!==!1&&i.execute(j)},this.onBeforeExecute=function(){return j.isBusy()?!1:(j.hasError(!1),j.callbacks.beforeExecute(),j.validate(),j.isValid()?j.callbacks.canExecute()===!1?!1:(j.isBusy(!0),!0):!1)},this.onError=function(){j.hasError(!0),"violations"in j.result&&null!=j.result.violations&&j.applyViolations(j.result.violations),j.callbacks.error(j.result)},this.onSuccess=function(){j.hasError(!1),j.clearValidationMessages(),j.callbacks.success(j.result),j.callbacks.result(j.result.result)},this.onComplete=function(){j.hasError()||(j.callbacks.complete(j.result),j.clearValidationMessages()),j.isBusy(!1)},j.name=e,j.type=f,c.extend(j.parameters,g),c.extend(j.callbacks,h),c.extend(j,new b(j.name,j.parameters,i.constraintResolver))}return e.Command="command",e.Query="query",e}),define("deco/ajax",[],function(){function a(a){var b=[];for(var c in a){var d=a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}function b(a,b,c){return a+(a.match(/\?/)?a.match(/&$/)?"":"&":"?")+encodeURIComponent(b)+"="+encodeURIComponent(c)}function c(b,c){var d=a(c);return b+(b.match(/\?/)?b.match(/&$/)?"":d.length>0?"&":"":"?")+d}function d(a,b){return a+(a.match(/\/$/)?"":"/")+b}function e(a){return b(a,"cacheKey",Math.floor(Math.random()*Math.pow(2,53)))}function f(b,d,f,g){var h=new XMLHttpRequest,i="POST"===f,j=null;return d&&(i?j=a(d):b=c(b,d)),i&&(b=e(b)),h.open(f,b,!0),i&&j&&h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.onreadystatechange=function(){4==h.readyState&&g(h)},h.send(j),h}return f.addParamToUrl=b,f.addParamsToUrl=c,f.addToPath=d,f.cacheBust=e,f}),define("deco/qvc/ConstraintResolver",[],function(){function a(a,b){for(var c=0;c<b.length;c++)if(b[c].name==a)return b[c];return!1}function b(b,c){var d=a(b,this.constraints);d&&(d.validatables.forEach(function(a){a.applyConstraints(c)}),d.fields=c,d.state=e,d.validatables=[])}function c(a){this.qvc=a,this.constraints=[]}var d="loading",e="loaded";return c.prototype.applyValidationConstraints=function(c,e){var f=a(c,this.constraints);f===!1?(this.constraints.push({name:c,state:d,validatables:[e]}),this.qvc.loadConstraints(c,b.bind(this))):f.state===d?f.validatables.push(e):e.applyConstraints(f.fields)},c}),define("deco/errorHandler",[],function(){return{onError:function(a){setTimeout(function(){throw a},1)}}}),define("deco/qvc",["deco/qvc/Executable","deco/qvc/ExecutableResult","deco/utils","deco/ajax","deco/qvc/ConstraintResolver","deco/errorHandler","knockout","deco/qvc/koExtensions"],function(a,b,c,d,e,f,g){function h(){var a=this;this.constraintResolver=new e(a),this.execute=function(c){var e=g.toJS(c.parameters),h={parameters:JSON.stringify(e),csrfToken:a.config.csrf},i=d.addToPath(a.config.baseUrl,c.type+"/"+c.name);d(i,h,"POST",function(a){200===a.status?(c.result=new b(JSON.parse(a.responseText||"{}")),c.result.success===!0?c.onSuccess():(c.result.exception&&c.result.exception.message&&f.onError(c.result.exception.message),c.onError())):(c.result=new b({exception:{message:a.responseText,cause:a}}),f.onError(c.result.exception.message),c.onError()),c.onComplete()})},this.loadConstraints=function(b,c){var e=d.addToPath(a.config.baseUrl,"constraints/"+b);d(e,null,"GET",function(a){if(200===a.status){try{var d=JSON.parse(a.responseText||'{"parameters":[]}');"parameters"in d==0&&(d.parameters=[]),d.exception&&d.exception.message&&f.onError(d.exception.message)}catch(e){var d={parameters:[]}}c(b,d.parameters)}else f.onError(a.responseText)})},this.config={baseUrl:"/",csrf:""}}function i(b,c,d,e){if(null==b||0==b.length)throw new Error(c+" is missing name\nA "+c+" must have a name!\nusage: createCommand('name', [parameters, callbacks])");var f=new a(b,c,d||{},e||{},j),h=f.execute.bind(f);return h.isValid=g.computed(function(){return f.isValid()}),h.isBusy=g.computed(function(){return f.isBusy()}),h.hasError=g.computed(function(){return f.hasError()}),h.success=function(a){return f.callbacks.success=a,h},h.error=function(a){return f.callbacks.error=a,h},h.beforeExecute=function(a){return f.callbacks.beforeExecute=a,h},h.canExecute=function(a){return f.callbacks.canExecute=a,h},h.result=function(){return 1==arguments.length?(f.callbacks.result=arguments[0],h):f.result.result},h.complete=function(a){return f.callbacks.complete=a,h},h.clearValidationMessages=f.clearValidationMessages.bind(f),h.validator=f.validator,h}var j=new h;return{createCommand:function(b,c,d){return i(b,a.Command,c,d)},createQuery:function(b,c,d){return i(b,a.Query,c,d)},config:function(a){c.extend(j.config,a)}}}),define("deco/spa/Outlet",["knockout"],function(a){function b(a,b){this.element=a,this.document=b||window.document}return b.prototype.outletExists=function(){return null!=this.element},b.prototype.unloadCurrentPage=function(){a.cleanNode(this.element),this.element.innerHTML=""},b.prototype.setPageContent=function(a){this.element.innerHTML=a},b.prototype.getPageTitle=function(){var a=this.element.querySelector("meta[name=title]");return a&&a.getAttribute("content")},b.prototype.setDocumentTitle=function(a){this.document.title=a},b.prototype.extractAndRunPageJavaScript=function(){for(var a=this.element.querySelectorAll("script[type='text/javascript']"),b=0;b<a.length;b++){if(a[b].parentNode.removeChild(a[b]),""===a[b].id)throw new Error("The script must have an id");if(null==this.document.getElementById(a[b].id)){var c=this.document.createElement("script");c.id=a[b].id,c.text=a[b].textContent,c.setAttribute("type",a[b].getAttribute("type")),this.document.body.appendChild(c)}}},b.prototype.indicatePageIsLoading=function(){this.element.setAttribute("data-loading","true")},b.prototype.pageHasLoaded=function(){this.element.setAttribute("data-loading","false")},b}),define("deco/spa/whenContext",[],function(){function a(a,b){a.dont(b)}function b(a,b){return a(b),a.dont.bind(null,b)}function c(){if(this.destroyed)throw new Error("This context has been destroyed!");if(0==arguments.length){var c=g();return this.childContexts.push(c),c.when}return 1==arguments.length&&"function"==typeof arguments[0]?{dont:a.bind(null,arguments[0])}:void(2==arguments.length&&"function"==typeof arguments[1]&&this.eventSubscribers.push(b(arguments[0],arguments[1])))}function d(a){this.onDestroyListeners.push(a)}function e(){for(var a;a=this.childContexts.pop();)a.destroyContext()}function f(){for(var a,b,c;a=this.eventSubscribers.pop();)a();for(;b=this.onDestroyListeners.pop();)b();for(;c=this.childContexts.pop();)c.destroyContext();this.destroyed=!0}function g(){var a={destroyed:!1,onDestroyListeners:[],childContexts:[],eventSubscribers:[]},b=c.bind(a);return b.thisIsDestroyed=d.bind(a),b.destroyChildContexts=e.bind(a),{when:b,destroyContext:f.bind(a)}}return g().when}),define("deco/spa/applyViewModels",["deco/utils","deco/errorHandler","knockout","when","when/callbacks"],function(a,b,c,d,e){function f(a){var b=a.getAttribute("data-viewmodel"),c=a.getAttribute("data-model");return c&&0==c.indexOf("{")&&(c=JSON.parse(c)),{target:a,viewModelName:b,model:c}}function g(a){return e.call(require,[a.viewModelName]).then(function(b){return a.ViewModel=b,a},function(a){return b.onError(new Error("Could not load the following modules:\n"+a.requireModules.join("\n"))),null})}function h(a,d){try{var e=new d.ViewModel(d.model||{},a);c.applyBindings(e,d.target)}catch(f){b.onError(f)}}function i(a){return null!=a&&null!=a.ViewModel}return function(b,c){b=b||document.body;var e=a.toArray(b.querySelectorAll("*[data-viewmodel]")),j=e.map(f).map(g);return d.all(j).then(function(a){a.filter(i).forEach(h.bind(null,c))})}}),define("deco/spa/hashNavigation",["deco/utils"],function(a){function b(b,c,d){var e=a.startsWith(c,"/")===!1,f=a.endsWith(c,"/");if("/"===c)var g=[];else if(""===c)var g=[d];else var g=a.trim(c,"/").split("/");f&&g.push(d),e&&(g=a.popTail(b).concat(g));for(var h=[],i=g.length>>>0;i--;)""!==g[i]&&"."!==g[i]&&(".."===g[i]?i--:h.unshift(g[i]));return h}function c(c,d,e){var f=a.after(e.location.href,"#"),g=0==a.startsWith(f,"/"),h=a.endsWith(f,"/");if(g||h){var i=b(this.currentPath,f,c.index).join("/");e.location.replace("#/"+i)}else this.currentPath=b(this.currentPath,f,c.index),d(this.currentPath.join("/"),this.currentPath.map(function(a){return decodeURIComponent(a)}))}function d(b,d,e,f){e=e||document,f=f||window;var g={currentPath:[]},h=c.bind(g,b,d,e);return h(),a.addEventListener(f,"hashchange",h,!1),{stop:function(){f.removeEventListener("hashchange",h,!1)}}}return{start:d}}),define("deco/spa/PageLoader",["deco/ajax"],function(a){function b(a){this.pathToUrl=a&&a.pathToUrl||function(a){return a},this.cache=a&&"cachePages"in a?a.cachePages:!0,this.currentXHR=null}return b.prototype.loadPage=function(b,c){this.abort();var d=this.pathToUrl(b);this.cache===!1&&(d=a.cacheBust(d)),this.currentXHR=a(d,{},"GET",function(a){200===a.status?c.resolve(a.responseText):c.reject({error:a.status,content:a.responseText})})},b.prototype.abort=function(){this.currentXHR&&4!==this.currentXHR.readyState&&this.currentXHR.abort()},b}),define("deco/spa/Templates",["deco/spa/PageLoader","deco/utils","when"],function(a,b,c){function d(){return{pathToUrl:function(a){return a}}}function e(a){var c=a.querySelectorAll("[type='text/page-template']"),d=b.toArray(c),e=d.map(function(a){return{id:a.id.toLowerCase(),content:a.innerHTML}});return b.arrayToObject(e,function(a,b){b[a.id]=a.content})}function f(b,c){this.pageLoader=new a(c||d()),this.cachePages=c&&"cachePages"in c?c.cachePages:!0,this.templates=e(b)}return f.prototype.getTemplate=function(a){this.pageLoader.abort();var b=a.toLowerCase();if(b in this.templates)return c.resolve(this.templates[b]);var d=c.defer();return this.pageLoader.loadPage(a,d.resolver),d.promise.then(function(a){return this.cachePages&&(this.templates[b]=a),a}.bind(this),function(a){var b="error"+a.error;return b in this.templates?this.templates[b]:a.content}.bind(this))},f}),define("deco/proclaimWhen",[],function(){function a(a,b,c){b.forEach(function(a){a.apply(a,c)})}function b(a,b,c){var d=b.indexOf(c);return 0>d&&b.push(c),0>d}function c(a,b,c){var d=b.indexOf(c);return d>=0&&b.splice(d,1),d>=0}function d(d,e){e.subscribers=[],e.subscribeSubscribers=[],e.unsubscribeSubscribers=[];var f=function(){1==arguments.length&&"function"==typeof arguments[0]?b(d,e.subscribers,arguments[0])&&a(d+".isSubscribedTo",e.subscribeSubscribers):a(d,e.subscribers,arguments)};return f.dont=function(b){c(d,e.subscribers,b)&&a(d+".isUnsubscribedFrom",e.unsubscribeSubscribers)},f.isSubscribedTo=function(a){b(d+".isSubscribedTo",e.subscribeSubscribers,a)},f.isSubscribedTo.dont=function(a){c(d+".isSubscribedTo",e.subscribeSubscribers,a)},f.isUnsubscribedFrom=function(a){b(d+".isUnsubscribedFrom",e.unsubscribeSubscribers,a)},f.isUnsubscribedFrom.dont=function(a){c(d+".isUnsubscribedFrom",e.unsubscribeSubscribers,a)},f.toString=function(){return"[Event "+d+"]"},f}function e(a){for(var b in a)a[b]=d(b,a[b]);return a}function f(a,b){return b?d(a,b):d("anonymous event",a)}return{extend:e,create:f}}),define("deco/events",["deco/proclaimWhen"],function(a){return a.extend({thePageHasChanged:function(){}})}),define("deco/spa",["deco/spa/Outlet","deco/spa/whenContext","deco/spa/applyViewModels","deco/spa/hashNavigation","deco/spa/Templates","deco/utils","deco/events"],function(a,b,c,d,e,f,g){function h(a){return l.unloadCurrentPage(),l.setPageContent(a),l.setDocumentTitle(l.getPageTitle()||m),l.extractAndRunPageJavaScript(),c(l.element,o())}function i(a,b){return l.indicatePageIsLoading(),o.destroyChildContexts(),n.getTemplate(a).then(h).then(function(){l.pageHasLoaded(),g.thePageHasChanged(a,b,document.location)})}function j(g,h){return k=h||window.document,p=f.extend(p,g),l=new a(k.querySelector("[data-outlet]"),k),m=k.title,o=b(),c(k,b()).then(function(){l.outletExists()&&(n=new e(k,p),d.start(p,i,k))})}var k,l,m,n,o,p={index:"index"};return{start:j}}),define("deco/deco",["deco/qvc","deco/spa"],function(a,b){function c(c){c=c||{};var d=c.spa||{},e=c.qvc||{};return a.config(e),{start:b.start.bind(null,d,document)}}return{config:c}}),define("deco",["deco/deco"],function(a){return a}),define("deco/qvc/constraints/NotEmpty",[],function(){function a(){}return a.prototype.isValid=function(a){return null==a?!1:"string"==typeof a&&0==a.length?!1:!0},a}),define("deco/qvc/constraints/Pattern",[],function(){function a(a){a.flags=a.flags||[];var b="";a.flags.indexOf("CASE_INSENSITIVE")>=0&&(b+="i"),this.regex=new RegExp(a.regexp,b)}return a.prototype.isValid=function(a){if(null==a)return!1;var b=this.regex.exec(a);return null==b?!1:b[0]==a},a});
//# sourceMappingURL=Dist/deco.min.js.map