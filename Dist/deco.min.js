define("deco/qvc/constraints/Pattern",[],function(){function t(t){t.flags=t.flags||[];var e="";t.flags.indexOf("CASE_INSENSITIVE")>=0&&(e+="i"),this.regex=new RegExp(t.regexp,e)}return t.prototype.isValid=function(t){if(null==t)return!1;var e=this.regex.exec(t);return null==e?!1:e[0]==t},t}),define("deco/qvc/constraints/NotEmpty",[],function(){function t(){}return t.prototype.isValid=function(t){return null==t?!1:"string"==typeof t&&0==t.length?!1:!0},t}),define("deco/proclaimWhen",[],function(){function t(t,e,n){e.forEach(function(t){t.apply(t,n)})}function e(t,e,n){var r=e.indexOf(n);return 0>r&&e.push(n),0>r}function n(t,e,n){var r=e.indexOf(n);return r>=0&&e.splice(r,1),r>=0}function r(r,i){i.subscribers=[],i.subscribeSubscribers=[],i.unsubscribeSubscribers=[];var o=function(){1==arguments.length&&"function"==typeof arguments[0]?e(r,i.subscribers,arguments[0])&&t(r+".isSubscribedTo",i.subscribeSubscribers):t(r,i.subscribers,arguments)};return o.dont=function(e){n(r,i.subscribers,e)&&t(r+".isUnsubscribedFrom",i.unsubscribeSubscribers)},o.isSubscribedTo=function(t){e(r+".isSubscribedTo",i.subscribeSubscribers,t)},o.isSubscribedTo.dont=function(t){n(r+".isSubscribedTo",i.subscribeSubscribers,t)},o.isUnsubscribedFrom=function(t){e(r+".isUnsubscribedFrom",i.unsubscribeSubscribers,t)},o.isUnsubscribedFrom.dont=function(t){n(r+".isUnsubscribedFrom",i.unsubscribeSubscribers,t)},o.toString=function(){return"[Event "+r+"]"},o}function i(t){for(var e in t)t[e]=r(e,t[e]);return t}function o(t,e){return e?r(t,e):r("anonymous event",t)}return{extend:i,create:o}}),define("deco/events",["deco/proclaimWhen"],function(t){return t.extend({thePageHasChanged:function(){}})}),define("deco/ajax",[],function(){function t(t){var e=[];for(var n in t){var r=t[n];e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}return e.join("&")}function e(t,e,n){return t+(t.match(/\?/)?t.match(/&$/)?"":"&":"?")+encodeURIComponent(e)+"="+encodeURIComponent(n)}function n(e,n){var r=t(n);return e+(e.match(/\?/)?e.match(/&$/)?"":r.length>0?"&":"":"?")+r}function r(t,e){return t+(t.match(/\/$/)?"":"/")+e}function i(t){return e(t,"cacheKey",Math.floor(Math.random()*Math.pow(2,53)))}function o(e,r,o,a){var s=new XMLHttpRequest,c="POST"===o,u=null;return r&&(c?u=t(r):e=n(e,r)),c&&(e=i(e)),s.open(o,e,!0),c&&u&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.onreadystatechange=function(){4==s.readyState&&a(s)},s.send(u),s}return o.addParamToUrl=e,o.addParamsToUrl=n,o.addToPath=r,o.cacheBust=i,o}),define("deco/spa/PageLoader",["deco/ajax"],function(t){function e(t){this.pathToUrl=t&&t.pathToUrl||function(t){return t},this.cache=t&&"cachePages"in t?t.cachePages:!0,this.currentXHR=null}return e.prototype.loadPage=function(e,n){this.abort();var r=this.pathToUrl(e);this.cache===!1&&(r=t.cacheBust(r)),this.currentXHR=t(r,{},"GET",function(t){200===t.status?n.resolve(t.responseText):n.reject({error:t.status,content:t.responseText})})},e.prototype.abort=function(){this.currentXHR&&4!==this.currentXHR.readyState&&this.currentXHR.abort()},e}),define("deco/utils",[],function(){return{toArray:function(t){for(var e=[],n=t.length>>>0;n--;)e[n]=t[n];return e},extend:function(t,e){e=e||{},t=t||{};for(var n in e)t[n]=e[n];return t},arrayToObject:function(t,e){return t.reduce(function(t,n){return e(n,t),t},{})},trim:function(t,e){for(;t.charAt(0)==e;)t=t.substr(1);for(;t.charAt(t.length-1)==e;)t=t.substr(0,t.length-1);return t},after:function(t,e){var n=t.indexOf(e);return 0>n?"":t.substr(n+1)},popTail:function(t){return t.slice(0,-1)},startsWith:function(t,e){return t.charAt(0)===e},endsWith:function(t,e){return t.charAt(t.length-1)===e},addEventListener:function(t,e,n,r){"addEventListener"in t?t.addEventListener(e,n,r):t.attachEvent("on"+e,n)}}}),define("deco/spa/Templates",["deco/spa/PageLoader","deco/utils","when"],function(t,e,n){function r(){return{pathToUrl:function(t){return t}}}function i(t){var n=t.querySelectorAll("[type='text/page-template']"),r=e.toArray(n),i=r.map(function(t){return{id:t.id.toLowerCase(),content:t.innerHTML}});return e.arrayToObject(i,function(t,e){e[t.id]=t.content})}function o(e,n){this.pageLoader=new t(n||r()),this.cachePages=n&&"cachePages"in n?n.cachePages:!0,this.templates=i(e)}return o.prototype.getTemplate=function(t){this.pageLoader.abort();var e=t.toLowerCase();if(e in this.templates)return n.resolve(this.templates[e]);var r=n.defer();return this.pageLoader.loadPage(t,r.resolver),r.promise.then(function(t){return this.cachePages&&(this.templates[e]=t),t}.bind(this),function(t){var e="error"+t.error;return e in this.templates?this.templates[e]:t.content}.bind(this))},o}),define("deco/spa/hashNavigation",["deco/utils"],function(t){function e(e,n,r){var i=t.startsWith(n,"/")===!1,o=t.endsWith(n,"/");if("/"===n)var a=[];else if(""===n)var a=[r];else var a=t.trim(n,"/").split("/");o&&a.push(r),i&&(a=t.popTail(e).concat(a));for(var s=[],c=a.length>>>0;c--;)""!==a[c]&&"."!==a[c]&&(".."===a[c]?c--:s.unshift(a[c]));return s}function n(n,r,i){var o=t.after(i.location.href,"#"),a=0==t.startsWith(o,"/"),s=t.endsWith(o,"/");if(a||s){var c=e(this.currentPath,o,n.index).join("/");i.location.replace("#/"+c)}else this.currentPath=e(this.currentPath,o,n.index),r(this.currentPath.join("/"),this.currentPath.map(function(t){return decodeURIComponent(t)}))}function r(e,r,i,o){i=i||document,o=o||window;var a={currentPath:[]},s=n.bind(a,e,r,i);return s(),t.addEventListener(o,"hashchange",s,!1),{stop:function(){o.removeEventListener("hashchange",s,!1)}}}return{start:r}}),define("deco/errorHandler",[],function(){return{onError:function(t){setTimeout(function(){throw t},1)}}}),define("deco/spa/applyViewModels",["deco/utils","deco/errorHandler","knockout","when","when/callbacks"],function(t,e,n,r,i){function o(t){var e=t.getAttribute("data-viewmodel"),n=t.getAttribute("data-model");return n&&0==n.indexOf("{")&&(n=JSON.parse(n)),{target:t,viewModelName:e,model:n}}function a(t){return i.call(require,[t.viewModelName]).then(function(e){return t.ViewModel=e,t},function(t){return e.onError(new Error("Could not load the following modules:\n"+t.requireModules.join("\n"))),null})}function s(t,r){try{var i=new r.ViewModel(r.model||{},t);n.applyBindings(i,r.target)}catch(o){e.onError(o)}}function c(t){return null!=t&&null!=t.ViewModel}return function(e,n){e=e||document.body;var i=t.toArray(e.querySelectorAll("*[data-viewmodel]")),u=i.map(o).map(a);return r.all(u).then(function(t){t.filter(c).forEach(s.bind(null,n))})}}),define("deco/spa/whenContext",[],function(){function t(t,e){t.dont(e)}function e(t,e){return t(e),t.dont.bind(null,e)}function n(){if(this.destroyed)throw new Error("This context has been destroyed!");if(0==arguments.length){var n=a();return this.childContexts.push(n),n.when}return 1==arguments.length&&"function"==typeof arguments[0]?{dont:t.bind(null,arguments[0])}:void(2==arguments.length&&"function"==typeof arguments[1]&&this.eventSubscribers.push(e(arguments[0],arguments[1])))}function r(t){this.onDestroyListeners.push(t)}function i(){for(var t;t=this.childContexts.pop();)t.destroyContext()}function o(){for(var t,e,n;t=this.eventSubscribers.pop();)t();for(;e=this.onDestroyListeners.pop();)e();for(;n=this.childContexts.pop();)n.destroyContext();this.destroyed=!0}function a(){var t={destroyed:!1,onDestroyListeners:[],childContexts:[],eventSubscribers:[]},e=n.bind(t);return e.thisIsDestroyed=r.bind(t),e.destroyChildContexts=i.bind(t),{when:e,destroyContext:o.bind(t)}}return a().when}),define("deco/spa/Outlet",["knockout"],function(t){function e(t,e){this.element=t,this.document=e||window.document}return e.prototype.outletExists=function(){return null!=this.element},e.prototype.unloadCurrentPage=function(){t.cleanNode(this.element),this.element.innerHTML=""},e.prototype.setPageContent=function(t){this.element.innerHTML=t},e.prototype.getPageTitle=function(){var t=this.element.querySelector("meta[name=title]");return t&&t.getAttribute("content")},e.prototype.setDocumentTitle=function(t){this.document.title=t},e.prototype.extractAndRunPageJavaScript=function(){for(var t=this.element.querySelectorAll("script[type='text/javascript']"),e=0;e<t.length;e++){if(t[e].parentNode.removeChild(t[e]),""===t[e].id)throw new Error("The script must have an id");if(null==this.document.getElementById(t[e].id)){var n=this.document.createElement("script");n.id=t[e].id,n.text=t[e].textContent,n.setAttribute("type",t[e].getAttribute("type")),this.document.body.appendChild(n)}}},e.prototype.indicatePageIsLoading=function(){this.element.setAttribute("data-loading","true")},e.prototype.pageHasLoaded=function(){this.element.setAttribute("data-loading","false")},e}),define("deco/spa",["deco/spa/Outlet","deco/spa/whenContext","deco/spa/applyViewModels","deco/spa/hashNavigation","deco/spa/Templates","deco/utils","deco/events"],function(t,e,n,r,i,o,a){function s(t){return d.unloadCurrentPage(),d.setPageContent(t),d.setDocumentTitle(d.getPageTitle()||f),d.extractAndRunPageJavaScript(),n(d.element,p())}function c(t,e){return d.indicatePageIsLoading(),p.destroyChildContexts(),h.getTemplate(t).then(s).then(function(){d.pageHasLoaded(),a.thePageHasChanged(t,e,document.location)})}function u(a,s){return l=s||window.document,v=o.extend(v,a),d=new t(l.querySelector("[data-outlet]"),l),f=l.title,p=e(),n(l,e()).then(function(){d.outletExists()&&(h=new i(l,v),r.start(v,c,l))})}var l,d,f,h,p,v={index:"index"};return{start:u}}),define("deco/qvc/ConstraintResolver",[],function(){function t(t,e){for(var n=0;n<e.length;n++)if(e[n].name==t)return e[n];return!1}function e(e,n){var r=t(e,this.constraints);r&&(r.validatables.forEach(function(t){t.applyConstraints(n)}),r.fields=n,r.state=i,r.validatables=[])}function n(t){this.qvc=t,this.constraints=[]}var r="loading",i="loaded";return n.prototype.applyValidationConstraints=function(n,i){var o=t(n,this.constraints);o===!1?(this.constraints.push({name:n,state:r,validatables:[i]}),this.qvc.loadConstraints(n,e.bind(this))):o.state===r?o.validatables.push(i):i.applyConstraints(o.fields)},n}),define("deco/qvc/Constraint",[],function(){function t(t,e){this.type=t,this.attributes=e,this.message=e.message,this.init(t)}return t.prototype.init=function(t){require(["deco/qvc/constraints/"+t],function(t){var e=new t(this.attributes);this.validate=e.isValid.bind(e)}.bind(this))},t.prototype.validate=function(){return!0},t}),define("deco/qvc/Validator",["deco/qvc/Constraint","knockout"],function(t,e){function n(t,e,n,r,i){return t.replace(/\{([^}]+)\}/g,function(t,o){return"value"==o?n:"this.name"==o?r:"this.path"==o?i:o in e?e[o]:t})}function r(t,n){this.constraints=[],this.isValid=e.observable(!0),this.message=e.observable(""),this.name=n&&n.name,this.path=n&&n.path}return r.prototype.setConstraints=function(e){this.constraints=e.map(function(e){return new t(e.name,e.attributes)})},r.prototype.reset=function(){this.isValid(!0),this.message("")},r.prototype.validate=function(t){0==this.constraints.length?this.reset():this.constraints.every(function(e){return e.validate(t)?!0:(this.isValid(!1),this.message(n(e.message,e.attributes,t,this.name,this.path)),!1)}.bind(this))&&(this.isValid(!0),this.message(""))},r}),define("deco/qvc/koExtensions",["deco/qvc/Validator","knockout"],function(t,e){null!=e&&(e.bindingHandlers.validationMessageFor={init:function(t,n){var r=n(),i=r.validator;if(!i){var o=Array.prototype.reduce.call(t.attributes,function(t,e){return t+" "+e.localName+'="'+e.value+'"'},"");throw new Error("Could not bind `validationMessageFor` to value on element <"+t.tagName.toLowerCase()+o+">")}e.applyBindingsToNode(t,{hidden:i.isValid,text:i.message},i)}},e.extenders.validation=function(e,n){return e.validator=new t(e,n),e.subscribe(function(t){e.validator.validate(t)}),e},e.bindingHandlers.command=e.bindingHandlers.query={init:function(t,n,r,i){e.applyBindingsToNode(t,{click:n()},i)}})}),define("deco/qvc/Validatable",["deco/utils","deco/qvc/Validator","knockout","deco/qvc/koExtensions"],function(t,e,n){function r(t,e,i){for(var o in t){var a=t[o],s=i.concat([o]);n.isObservable(a)&&(a.extend({validation:{name:o,path:s.join(".")}}),e.push(a)),a=n.utils.unwrapObservable(a),"object"==typeof a&&r(a,e,s)}}function i(t,e,r){return t.split(".").reduce(function(e,i){var o=e.path,a=n.utils.unwrapObservable(e.field);if(i in a)return{field:a[i],path:o+"."+i};throw new Error(r+": "+t+"\n"+i+" is not a member of "+o+"\n"+o+" = `"+n.toJSON(a)+"`")},{field:e,path:"parameters"}).field}function o(t,e,n){var r=i(e,t,"Error applying violation");if(!("string"==typeof n&&"validator"in r))throw new Error("Error applying violation\n"+e+" is not validatable\nit should be an observable");r.validator.isValid(!1),r.validator.message(n)}function a(t,e){t.validator.isValid(!1);var n=t.validator.message(),r=0==n.length?e:n+", "+e;t.validator.message(r)}function s(t,n,i){var o=this;this.validator=new e,this.validatableFields=[],this.validatableParameters=n,r(o.validatableParameters,o.validatableFields,[]),i&&i.applyValidationConstraints(t,o)}return s.prototype.isValid=function(){return this.validatableFields.every(function(t){return t.validator&&t.validator.isValid()})&&this.validator.isValid()},s.prototype.applyViolations=function(t){t.forEach(function(t){var e=t.message,n=t.fieldName;n.length>0?o(this.validatableParameters,n,e):a(this,e)}.bind(this))},s.prototype.applyConstraints=function(t){var e=this.validatableParameters;t.forEach(function(t){var r=t.name,o=t.constraints;if(null!=o&&0!=o.length){var a=i(r,e,"Error applying constraints to field");if(!(n.isObservable(a)&&"validator"in a))throw new Error("Error applying constraints to field: "+r+"\nIt is not an observable or is not extended with a validator. \n"+r+"=`"+n.toJSON(a)+"`");a.validator.setConstraints(o)}})},s.prototype.validate=function(){this.validator.validate(!0),this.validator.isValid()&&this.validatableFields.forEach(function(t){var e=t.validator;e&&e.validate(t())})},s.prototype.clearValidationMessages=function(){this.validator.reset(),this.validatableFields.forEach(function(t){var e=t.validator;e&&e.reset()})},s}),define("deco/qvc/ExecutableResult",["deco/utils"],function(t){function e(e){this.success=!1,this.valid=!1,this.result=null,this.exception=null,this.violations=[],t.extend(this,e)}return e}),define("deco/qvc/Executable",["deco/qvc/ExecutableResult","deco/qvc/Validatable","deco/utils","knockout"],function(t,e,n,r){function i(i,o,a,s,c){var u=this;this.name,this.type,this.isBusy=r.observable(!1),this.hasError=r.observable(!1),this.result=new t,this.parameters={},this.callbacks={beforeExecute:function(){},canExecute:function(){return!0},error:function(){},success:function(){},result:function(){},complete:function(){}},this.execute=function(){u.onBeforeExecute()!==!1&&c.execute(u)},this.onBeforeExecute=function(){return u.isBusy()?!1:(u.hasError(!1),u.callbacks.beforeExecute(),u.validate(),u.isValid()?u.callbacks.canExecute()===!1?!1:(u.isBusy(!0),!0):!1)},this.onError=function(){u.hasError(!0),"violations"in u.result&&null!=u.result.violations&&u.applyViolations(u.result.violations),u.callbacks.error(u.result)},this.onSuccess=function(){u.hasError(!1),u.clearValidationMessages(),u.callbacks.success(u.result),u.callbacks.result(u.result.result)},this.onComplete=function(){u.hasError()||(u.callbacks.complete(u.result),u.clearValidationMessages()),u.isBusy(!1)},u.name=i,u.type=o,n.extend(u.parameters,a),n.extend(u.callbacks,s),n.extend(u,new e(u.name,u.parameters,c.constraintResolver))}return i.Command="command",i.Query="query",i}),define("deco/qvc",["deco/qvc/Executable","deco/qvc/ExecutableResult","deco/utils","deco/ajax","deco/qvc/ConstraintResolver","deco/errorHandler","knockout","deco/qvc/koExtensions"],function(t,e,n,r,i,o,a){function s(){var t=this;this.constraintResolver=new i(t),this.execute=function(n){var i=a.toJS(n.parameters),s={parameters:JSON.stringify(i),csrfToken:t.config.csrf},c=r.addToPath(t.config.baseUrl,n.type+"/"+n.name);r(c,s,"POST",function(t){200===t.status?(n.result=new e(JSON.parse(t.responseText||"{}")),n.result.success===!0?n.onSuccess():(n.result.exception&&n.result.exception.message&&o.onError(n.result.exception.message),n.onError())):(n.result=new e({exception:{message:t.responseText,cause:t}}),o.onError(n.result.exception.message),n.onError()),n.onComplete()})},this.loadConstraints=function(e,n){var i=r.addToPath(t.config.baseUrl,"constraints/"+e);r(i,null,"GET",function(t){if(200===t.status){try{var r=JSON.parse(t.responseText||'{"parameters":[]}');"parameters"in r==0&&(r.parameters=[]),r.exception&&r.exception.message&&o.onError(r.exception.message)}catch(i){var r={parameters:[]}}n(e,r.parameters)}else o.onError(t.responseText)})},this.config={baseUrl:"/",csrf:""}}function c(e,n,r,i){if(null==e||0==e.length)throw new Error(n+" is missing name\nA "+n+" must have a name!\nusage: createCommand('name', [parameters, callbacks])");var o=new t(e,n,r||{},i||{},u),s=o.execute.bind(o);return s.isValid=a.computed(function(){return o.isValid()}),s.isBusy=a.computed(function(){return o.isBusy()}),s.hasError=a.computed(function(){return o.hasError()}),s.success=function(t){return o.callbacks.success=t,s},s.error=function(t){return o.callbacks.error=t,s},s.beforeExecute=function(t){return o.callbacks.beforeExecute=t,s},s.canExecute=function(t){return o.callbacks.canExecute=t,s},s.result=function(){return 1==arguments.length?(o.callbacks.result=arguments[0],s):o.result.result},s.complete=function(t){return o.callbacks.complete=t,s},s.clearValidationMessages=o.clearValidationMessages.bind(o),s.validator=o.validator,s}var u=new s;return{createCommand:function(e,n,r){return c(e,t.Command,n,r)},createQuery:function(e,n,r){return c(e,t.Query,n,r)},config:function(t){n.extend(u.config,t)}}}),define("deco/deco",["deco/qvc","deco/spa"],function(t,e){function n(n){n=n||{};var r=n.spa||{},i=n.qvc||{};return t.config(i),{start:e.start.bind(null,r,document)}}return{config:n}});